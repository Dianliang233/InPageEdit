{"version":3,"sources":["webpack://mediawiki-inpageedit/./method/_dir.js","webpack://mediawiki-inpageedit/./method/beforeInstall.js","webpack://mediawiki-inpageedit/./method/getUserInfo.js","webpack://mediawiki-inpageedit/./method/init.js","webpack://mediawiki-inpageedit/./method/loadScript.js","webpack://mediawiki-inpageedit/./method/loadStyles.js","webpack://mediawiki-inpageedit/./method/syncI18nData.js","webpack://mediawiki-inpageedit/./method/updateNotice.js","webpack://mediawiki-inpageedit/./module/_analysis.js","webpack://mediawiki-inpageedit/./module/_elements.js","webpack://mediawiki-inpageedit/./module/_hasRight.js","webpack://mediawiki-inpageedit/./module/_msg.js","webpack://mediawiki-inpageedit/./module/_resolveExists.js","webpack://mediawiki-inpageedit/./module/about.js","webpack://mediawiki-inpageedit/./module/articleLink.js","webpack://mediawiki-inpageedit/./module/findAndReplace.js","webpack://mediawiki-inpageedit/./module/linksHere.js","webpack://mediawiki-inpageedit/./module/loadQuickDiff.js","webpack://mediawiki-inpageedit/./module/pluginStore.js","webpack://mediawiki-inpageedit/./module/preference.js","webpack://mediawiki-inpageedit/./module/progress.js","webpack://mediawiki-inpageedit/./module/quickDelete.js","webpack://mediawiki-inpageedit/./module/quickDiff.js","webpack://mediawiki-inpageedit/./module/quickEdit.js","webpack://mediawiki-inpageedit/./module/quickPreview.js","webpack://mediawiki-inpageedit/./module/quickRedirect.js","webpack://mediawiki-inpageedit/./module/quickRename.js","webpack://mediawiki-inpageedit/./module/specialNotice.js","webpack://mediawiki-inpageedit/./module/stepModal.js","webpack://mediawiki-inpageedit/./module/version.js","webpack://mediawiki-inpageedit/./module/versionInfo.js","webpack://mediawiki-inpageedit/webpack/bootstrap","webpack://mediawiki-inpageedit/./index.js"],"names":["_dir","thisUrl","document","currentScript","src","split","pop","join","module","exports","config","mw","get","stepModal","require","$checkbox","$hr","_msg","beforeInstall","async","force","$def","$","Deferred","options","skip","localStorage","getItem","resolve","contents","push","content","append","text","Date","getFullYear","href","html","id","label","css","checked","value","display","width","wgUserLanguage","title","btnBefore","btnAfter","btnDone","onShow","modal","$modal","modalId","addEvent","find","unbind","change","val","$el","this","attr","prop","click","then","setItem","getTime","mwApi","Api","getUserInfo","data","set","rights","error","action","list","usprop","ususers","query","users","blockid","loadScript","loadStyles","updateNotice","syncI18nData","version","hook","fire","purgeCache","Boolean","util","getParamValue","location","loader","using","ssi_modal","window","_analysis","about","api","articleLink","findAndReplace","linksHere","loadQuickDiff","preference","pluginStore","progress","quickDelete","quickDiff","quickEdit","quickPreview","quickRedirect","quickRename","specialNotice","versionInfo","installOpt","initUserPlugin","InPageEdit","fnr","delete","diff","edit","preview","redirect","quickMove","rename","forEach","key","Object","freeze","e","noCache","ajax","url","dataType","crossDomain","cache","purge","link","test","prepend","rel","cacheUrl","localCacheName","localCacheTime","getOriginalData","getJSON","timestamp","now","JSON","stringify","saveToCache","json","parse","en","notify","className","buttons","method","a","close","closeAfter","time","resetOnHover","onClose","functionID","submitdata","wgServer","wgArticlePath","replace","sitename","wgSiteName","username","wgUserName","function","analysis","type","done","getUrl","$br","$progress","br","$button","$btn","class","target","$a","appendTo","hr","$link","page","_hasRight","right","wgUserIsBlocked","indexOf","funcName","userLang","fallbacks","ab","ace","aln","als","an","anp","arn","arz","av","ay","ba","bar","bcc","bh","bjn","bm","bpy","bqi","bug","ce","ckb","crh","csb","cv","dsb","dtp","eml","ff","frc","frp","frr","fur","gag","gan","gl","glk","gn","gsw","hif","hsb","ht","ii","inh","iu","jut","jv","kaa","kbd","khw","kiu","kk","kl","koi","krc","ks","ksh","ku","kv","lad","lb","lbe","lez","li","lij","liv","lmo","ln","ltg","lzz","mai","mg","mhr","min","mo","mrj","mwl","myv","mzn","nah","nap","nds","no","os","pcd","pdc","pdt","pfl","pms","qu","qug","rgn","rmy","rue","ruq","sa","sah","scn","sg","sgs","shi","simple","sli","sr","srn","stq","su","szl","tcy","tg","tt","ty","udm","ug","uk","vec","vep","vls","vmf","vot","vro","wa","wo","wuu","xal","xmf","yi","za","zea","zh","makeLink","hasProtocol","blank","escape","parseWikitext","message","context","$html","$div","whitelistAttrs","whitelistTags","implementation","createHTMLDocument","parseHTML","each","attrs","style","$this","tagname","toLowerCase","log","remove","Array","prototype","slice","call","name","removeAttr","_match","count","forms","language","convertPlural","Number","gender","parseMessage","msg","args","elem","index","rgx","RegExp","handleArgs","getMessage","lang","msgKey","i18nCache","after","length","cacheMessages","toObject","overrides","i18n","_resolveExists","reason","canDelete","show","sizeClass","center","outSideClose","summary","reload","hide","aboutUrl","el","undefined","_","item","section","revision","addClass","decodeURI","wgIsArticle","element","origin","rows","searchexp","searchfor","$textarea","replacewith","flagg","flagi","enableregex","flags","rcount","matched","match","isFile","wgFormattedNamespaces","wgPageName","$progressBar","$content","createObject","init","setTitle","setContent","opt","format","titles","fulimit","lhlimit","getList","pages","pageId","keys","pageList","fileusage","linkshere","$list","makeList","err","addLink","ipeDiffLink","preventDefault","curid","oldid","fromrev","toid","torelative","torev","setInterval","wgAction","before","pluginCDN","saveCache","ipe","pluginList","loadCache","load","userPlugins","defaultSettings","editMinor","editSummary","lockToolBox","redLinkQuickEdit","shareMyInfo","watchList","user","plugins","settingKey","settingValue","extend","default","setting","local","myPreference","$tabList","$tabContent","for","placeholder","position","top","transform","pluginGithub","disabled","$saveLocalModal","readonly","select","$modalContent","dialog","okBtn","isCanary","onclick","tab","removeClass","confirm","cancelBtn","res","$modalWindow","setDisabled","obj","isArr","$input","usedPlugin","pluginCache","showPluginList","description","author","_force","original","splice","userName","ret","total","_total","functionData","functions","functionList","toFixed","closeIcon","givenReason","beforeShow","result","postWithToken","fail","errorCode","feedback","errorThrown","param","$modalTitle","$diffArea","$loading","wikiScript","fixedHeight","fitScreen","height","totext","topst","fromtext","frompst","post","toTitle","diffTable","compare","userLink","pageName","totitle","colspan","wgScript","fromrevid","fromtitle","fromuser","fromparsedcomment","torevid","touser","toparsedcomment","fromsize","tosize","isPreview","warnings","fromtexthidden","totexthidden","fromuserhidden","touserhidden","fromcommenthidden","tocommenthidden","info","code","defaultOptions","summaryRevision","editText","editNotice","jsonGet","jsonPost","pageDetail","jumpTo","userPreference","date","toUTCString","wgCurRevisionId","$editTools","$editArea","$optionsLabel","side","minor","basetimestamp","starttimestamp","errorformat","saveSuccess","setTimeout","saveError","errorInfo","errorMore","errors","warning","postArticle","pst","open","middle","icon","btns","i","btn","strings","textarea","start","selectionStart","stop","selectionEnd","selectedText","selectStart","setSelectionRange","focus","insertText","contentDone","summaryVal","wikitext","pageid","fadeIn","sections","line","anchor","diffJson","hideBtn","fromsection","queryJson","inprop","queryDone","namespace","ns","protection","revisions","level","wgNamespaceNumber","namespaceNoticePage","pageNoticePage","meta","ammessages","wikitextNs","allmessages","wikitextPage","contentmodel","notice","pageids","b","bind","beforeClose","keepContent","templateName","templates","imageName","images","iiprop","imageinfo","params","modalSize","disableeditsection","parent","question","createonly","failed","fromPage","toPage","from","to","movetalk","movesubpages","noredirect","getNotice","cb","isViewed","noticeList","getLocal","includes","noticeContainer","setLocal","step","afterDone","isNaN","unshift","allSteps","$modalObj","getElementById","setButtons","$btnAfter","$btnDone","setStep","$btnBefore","updatelogsUrl","githubLink","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","loaded","mainFunctions"],"mappings":"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","file":"InPageEdit.min.js","sourcesContent":["/**\n * @method getDir\n * @return {String} 插件CDN的URL路径，结尾没有/\n *\n * @description 注意，如果您想自己自己托管InPageEdit，_dir可以直接返回您的URL\n *              例如 const _dir = https://yourdomain.com/inpageedit\n */\nfunction getDir() {\n  var thisScript = document.currentScript.src\n  var thisUrl = thisScript.split('/')\n  // 理论上入口文件位于 /dist/*.js\n  // 因此删掉最后两位路径\n  thisUrl.pop()\n  thisUrl.pop()\n  thisUrl = thisUrl.join('/')\n  return thisUrl\n}\n\n/**\n * @constant {String} _dir CDN URL\n */\nconst _dir = getDir()\n\nmodule.exports = _dir\n","var config = mw.config.get()\nconst { stepModal } = require('../module/stepModal')\nconst { $checkbox, $hr } = require('../module/_elements')\nconst { _msg } = require('../module/_msg')\n\n/**\n * @param {Boolean} force Force show the steps modal @default false\n * @returns {Promise} User options\n */\nconst beforeInstall = async (force = false) => {\n  // 创建 Deferred 类\n  var $def = $.Deferred()\n\n  // 缓存选项\n  var options = {}\n\n  // 判定是否显示\n  var skip = true\n  // 选项为强制显示\n  if (force) skip = false\n  // 从未显示过\n  if (!localStorage.getItem('InPageEditInstallGuide')) skip = false\n\n  /**\n   * @function setOption\n   * @param {Element} el DOM element\n   */\n  function setOption(el) {\n    var $el = $(el)\n    var id = $el.attr('id')\n    if (!id) return\n    var val\n    if ($el.attr('type') === 'checkbox') {\n      val = $el.prop('checked')\n    } else {\n      val = $el.val()\n    }\n    options[id] = val\n    console.info('[InPageEdit] beforeInstall setOption', `${id}: ${val}`)\n  }\n\n  if (skip) {\n    console.info('[InPageEdit] Skip InPageEdit Install guide')\n    $def.resolve(options)\n  } else {\n    // 设置步骤\n    var contents = []\n\n    // 欢迎辞\n    contents.push({\n      content: $('<div>').append(\n        $('<h3>', { text: _msg('preference-about-label') }),\n        $('<div>', { text: _msg('beforeInstall-greeting-description') }),\n        $hr,\n        $('<p>', {\n          text:\n            'InPageEdit is a useful MediaWiki JavaScript Plugin written with jQuery',\n        }),\n        $('<p>').append(\n          '© InPageEdit Copyright (C)',\n          ' 2019 - ' + new Date().getFullYear(),\n          ' Wjghj Project (机智的小鱼君), ',\n          $('<a>', {\n            href: 'https://www.gnu.org/licenses/gpl-3.0-standalone.html',\n            text: 'GNU General Public License 3.0',\n          })\n        )\n      ),\n    })\n    // 隐私政策\n    contents.push({\n      content: $('<div>').append(\n        $('<h3>', { text: _msg('beforeInstall-privacy-policy-title') }),\n        $('<div>').append(\n          $('<div>', {\n            html: _msg('beforeInstall-privacy-policy-description'),\n          }),\n          $hr,\n          $checkbox({\n            id: 'shareMyInfo',\n            label: _msg('beforeInstall-privacy-policy-label'),\n          })\n        )\n      ),\n    })\n    // 首选项\n    contents.push({\n      content: $('<div>').append(\n        $('<h3>', { text: _msg('preference-title') }),\n        $('<div>').append(\n          $('<div>', {\n            text: _msg('beforeInstall-preference-description'),\n          }).css({ 'font-size': '0.8em' }),\n          $('<h4>', { text: _msg('preference-editHobits-label') }),\n          $checkbox({ id: 'editMinor', label: _msg('preference-setMinor') }),\n          $checkbox({\n            id: 'watchList',\n            label: _msg('preference-watchList'),\n            checked: true,\n          }),\n          $checkbox({\n            id: 'watchoutSideCloseList',\n            label: _msg('preference-outSideClose'),\n            checked: true,\n          }),\n          $('<h4>', { text: _msg('preference-summary-label') }),\n          $('<label>').append(\n            $('<span>', { html: _msg('preference-editSummary') }),\n            $('<input>', {\n              id: 'editSummary',\n              value: _msg('preference-summary-default'),\n            }).css({\n              display: 'block',\n              width: '96%',\n            })\n          )\n        )\n      ),\n    })\n    // 打赏\n    if (\n      config.wgUserLanguage === 'zh' ||\n      config.wgUserLanguage === 'zh-hans' ||\n      config.wgUserLanguage === 'zh-cn'\n    ) {\n      contents.push({\n        content: $('<div>').append(\n          $('<h3>', { text: '支持作者' }),\n          $('<div>').append(\n            '该步骤拟定推送给简体中文使用者，并附上作者的收款码。但经过与部分用户的交流后，作者意识到接受打赏可能会导致冲塔，故暂时省略了此步骤。您可以直接点击下一步按钮忽略这一步。'\n          )\n        ),\n      })\n    }\n    // 完成安装\n    contents.push({\n      content: $('<div>').append(\n        $('<h3>', { text: _msg('beforeInstall-success-title') }),\n        $('<div>', { text: _msg('beforeInstall-success-description') })\n      ),\n    })\n\n    // 显示模态框\n    stepModal({\n      title: _msg('beforeInstall-title'),\n      btnBefore: _msg('beforeInstall-before-btn'),\n      btnAfter: _msg('beforeInstall-after-btn'),\n      btnDone: _msg('beforeInstall-done-btn'),\n      contents,\n      onShow(modal) {\n        var $modal = $('#' + modal.modalId)\n        function addEvent() {\n          $modal.find('input').unbind()\n          $modal.find('input').change(function () {\n            setOption(this)\n          })\n        }\n        addEvent()\n        $modal.find('.ssi-modalBtn.btn').click(addEvent)\n      },\n    }).then(() => {\n      localStorage.setItem('InPageEditInstallGuide', new Date().getTime())\n      $def.resolve(options)\n    })\n  }\n\n  // 返回 Promise\n  return $def\n}\n\nmodule.exports = {\n  beforeInstall,\n}\n","var mwApi = new mw.Api()\n\nvar getUserInfo = function () {\n  /**\n   * @description 获取用户权限信息\n   */\n  mwApi.getUserInfo().then(\n    data => {\n      console.info('[InPageEdit] 成功获取用户权限信息')\n      mw.config.set('wgUserRights', data.rights)\n    },\n    error => {\n      console.warn('[InPageEdit] 警告：无法获取用户权限信息', error)\n      mw.config.set('wgUserRights', [])\n    }\n  )\n\n  /**\n   * @description 获取封禁状态\n   */\n  if (mw.config.get('wgUserName') !== null) {\n    mwApi\n      .get({\n        action: 'query',\n        list: 'users',\n        usprop: 'blockinfo',\n        ususers: mw.config.get('wgUserName'),\n      })\n      .then(data => {\n        if (data.query.users[0].blockid) {\n          mw.config.set('wgUserIsBlocked', true)\n        } else {\n          mw.config.set('wgUserIsBlocked', false)\n        }\n      })\n  }\n}\n\nmodule.exports = {\n  getUserInfo,\n}\n","// 导入方法\nconst _dir = require('./_dir')\nconst { loadScript } = require('./loadScript')\nconst { getUserInfo } = require('./getUserInfo')\nconst { loadStyles } = require('./loadStyles')\nconst { updateNotice } = require('./updateNotice')\nconst { syncI18nData } = require('./syncI18nData')\n\nconst version = require('../module/version')\nconst { beforeInstall } = require('./beforeInstall')\n\n/**\n * @method initMain\n * @return {Object} InPageEdit\n */\nmodule.exports = async function init() {\n  mw.hook('InPageEdit.init.before').fire()\n\n  // 是否需要刷新缓存\n  const purgeCache = Boolean(\n    mw.util.getParamValue('ipe', location.href) === 'nocache' ||\n      version !== localStorage.getItem('InPageEditVersion')\n  )\n\n  // Await MediaWiki\n  await mw.loader.using(['mediawiki.api', 'mediawiki.util', 'mediawiki.user'])\n\n  // 等待前置插件\n  await loadScript(_dir + '/src/ssi_modal/ssi-modal.min.js')\n  mw.hook('InPageEdit.init.modal').fire({ ssi_modal: window.ssi_modal })\n\n  // 加载样式表\n  loadStyles(purgeCache)\n\n  // 等待 i18n 缓存\n  await syncI18nData(purgeCache)\n  mw.hook('InPageEdit.init.i18n').fire({ _msg: require('../module/_msg')._msg })\n\n  // 导入全部模块\n  const { _analysis } = require('../module/_analysis')\n  const { _msg } = require('../module/_msg')\n  const { about } = require('../module/about')\n  const api = require('../module/api.json')\n  const { articleLink } = require('../module/articleLink')\n  const { findAndReplace } = require('../module/findAndReplace')\n  const { linksHere } = require('../module/linksHere')\n  const { loadQuickDiff } = require('../module/loadQuickDiff')\n  const { preference } = require('../module/preference')\n  const { pluginStore } = require('../module/pluginStore')\n  const { progress } = require('../module/progress')\n  const { quickDelete } = require('../module/quickDelete')\n  const { quickDiff } = require('../module/quickDiff')\n  const { quickEdit } = require('../module/quickEdit')\n  const { quickPreview } = require('../module/quickPreview')\n  const { quickRedirect } = require('../module/quickRedirect')\n  const { quickRename } = require('../module/quickRename')\n  const { specialNotice } = require('../module/specialNotice')\n  const { versionInfo } = require('../module/versionInfo')\n\n  // 等待安装前置步骤\n  var installOpt = await beforeInstall()\n  console.info('[InPageEdit]', 'Install options', installOpt)\n\n  // 初始化前置模块\n  preference.set()\n  preference.set(installOpt)\n  getUserInfo()\n  loadQuickDiff()\n  articleLink()\n  updateNotice()\n  // specialNotice()\n\n  // !暂定，触发用户插件\n  pluginStore.initUserPlugin()\n\n  // 写入模块\n  var InPageEdit = {\n    _dir,\n    about,\n    api,\n    articleLink,\n    beforeInstall,\n    findAndReplace,\n    linksHere,\n    loadQuickDiff,\n    preference,\n    progress,\n    quickDelete,\n    quickDiff,\n    quickEdit,\n    quickPreview,\n    quickRedirect,\n    quickRename,\n    specialNotice,\n    version,\n    versionInfo,\n    // 别名 Alias\n    fnr: findAndReplace,\n    delete: quickDelete,\n    diff: quickDiff,\n    edit: quickEdit,\n    preview: quickPreview,\n    redirect: quickRedirect,\n    quickMove: quickRename,\n    rename: quickRename,\n  }\n\n  // 锁定重要变量\n  var importantVariables = ['_dir', 'api', 'version']\n  importantVariables.forEach(key => {\n    try {\n      Object.freeze(InPageEdit[key])\n    } catch (e) {\n      // Do nothing\n    }\n  })\n\n  // 触发钩子，传入上下文\n  mw.hook('InPageEdit').fire({\n    _analysis,\n    _msg,\n    InPageEdit,\n  })\n\n  // 花里胡哨的加载提示\n  console.info(\n    '    ____      ____                   ______    ___ __ \\n   /  _/___  / __ \\\\____ _____ ____  / ____/___/ (_) /_\\n   / // __ \\\\/ /_/ / __ `/ __ `/ _ \\\\/ __/ / __  / / __/\\n _/ // / / / ____/ /_/ / /_/ /  __/ /___/ /_/ / / /_  \\n/___/_/ /_/_/    \\\\__,_/\\\\__, /\\\\___/_____/\\\\__,_/_/\\\\__/  \\n                      /____/                v' +\n      version\n  )\n\n  // 传回InPageEdit\n  return InPageEdit\n}\n","var loadScript = function (src, noCache) {\n  return $.ajax({\n    url: src,\n    dataType: 'script',\n    crossDomain: true,\n    cache: !noCache,\n  })\n}\n\nmodule.exports = {\n  loadScript,\n}\n","const _dir = require('./_dir')\n\nfunction loadStyles(purge) {\n  // 放在越上面优先级越高\n  const styleFiles = [\n    // Default Skin\n    '/src/skin/ipe-default.min.css',\n    // ssi-modal Style\n    '/src/ssi_modal/ssi-modal.min.css',\n    // FontAwesome\n    'https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css',\n  ]\n\n  styleFiles.forEach(link => {\n    if (/^https?:\\/\\//.test(link) !== true) {\n      link = _dir + link\n    }\n    if (purge) {\n      link += '?timestamp' + new Date().getTime()\n    }\n    $('head').prepend(\n      $('<link>', { href: link, rel: 'stylesheet', 'data-ipe': 'style' })\n    )\n  })\n}\n\nmodule.exports = {\n  loadStyles,\n}\n","var config = mw.config.get()\n\nconst _dir = require('./_dir')\n\n// 设置\nconst cacheTime = 2 * 60 * 60 * 1000\nconst cacheUrl = _dir + '/i18n/languages.json'\nconst funcName = 'InPageEdit'\nconst localCacheName = 'i18n-cache-' + funcName + '-content'\nconst localCacheTime = 'i18n-cache-' + funcName + '-timestamp'\n\n/**\n * @method i18n Get i18n data\n * @param {Boolean} noCache true - forced no cache\n */\nasync function syncI18nData(noCache) {\n  const now = new Date().getTime()\n  // 如果语言为 qqx，不返回任何东西\n  if (config.wgUserLanguage === 'qqx') {\n    console.warn('[InPageEdit] User language is qqx')\n    return true\n  }\n  // 缓存存在且缓存未过期\n  if (\n    localStorage.getItem(localCacheName) &&\n    now - localStorage.getItem(localCacheTime) < cacheTime &&\n    !noCache\n  ) {\n    var json = {}\n    try {\n      json = JSON.parse(localStorage.getItem(localCacheName))\n    } catch (e) {\n      console.warn('[InPageEdit] i18n 数据不合法')\n      await getOriginalData()\n      return true\n    }\n    if (json.en) {\n      return true\n    } else {\n      console.warn('[InPageEdit] i18n 数据可能已损坏')\n      await getOriginalData()\n      return true\n    }\n  } else {\n    await getOriginalData()\n    return true\n  }\n}\n\n/**\n * @function saveToCache\n */\nfunction saveToCache(data) {\n  const now = new Date().getTime()\n  data = JSON.stringify(data)\n  localStorage.setItem(localCacheName, data)\n  localStorage.setItem(localCacheTime, now)\n}\n\n/**\n * @function getOriginalData\n */\nasync function getOriginalData() {\n  console.time('[InPageEdit] 从远程获取 i18n 数据')\n  var data = await $.getJSON(cacheUrl, {\n    cache: false,\n    timestamp: new Date().getTime(),\n  })\n  if (typeof data !== 'object') data = {}\n  saveToCache(data)\n  console.timeEnd('[InPageEdit] 从远程获取 i18n 数据')\n  return data\n}\n\nmodule.exports = {\n  syncI18nData,\n}\n","const version = require('../module/version')\n\nconst { _msg } = require('../module/_msg')\n// const api = require('../module/api.json');\nconst { versionInfo } = require('../module/versionInfo')\nconst { specialNotice } = require('../module/specialNotice')\n\nfunction updateNotice() {\n  if (localStorage.getItem('InPageEditVersion') !== version) {\n    ssi_modal.notify('', {\n      title: _msg('updatelog-update-success-title'),\n      content: _msg('updatelog-update-success', version),\n      className: 'in-page-edit',\n      buttons: [\n        {\n          className: 'btn btn-primary',\n          label: _msg('updatelog-button-versioninfo'),\n          method(a, modal) {\n            localStorage.setItem('InPageEditVersion', version)\n            versionInfo()\n            modal.close()\n          },\n        },\n      ],\n      closeAfter: {\n        time: 10,\n        resetOnHover: true,\n      },\n      onClose() {\n        localStorage.setItem('InPageEditVersion', version)\n        // ssi_modal.notify('', {\n        //   className: 'in-page-edit',\n        //   content: _msg('updatelog-after-close', `[${api.updatelogsUrl} ${api.updatelogsUrl}]`, `[${api.githubLink}/issues ${_msg('updatelog-file-issue')}]`),\n        //   closeAfter: {\n        //     time: 10\n        //   },\n        //   buttons: [{\n        //     className: 'btn btn-primary',\n        //     label: _msg('ok'),\n        //     method(a, modal) {\n        //       modal.close();\n        //     }\n        //   }]\n        // });\n      },\n    })\n  }\n  if (localStorage.getItem('InPageEditNoticeId') !== _msg('noticeid')) {\n    specialNotice()\n  }\n}\n\nmodule.exports = {\n  updateNotice,\n}\n","var config = mw.config.get()\nvar api = require('./api.json')\n\nconst { preference } = require('./preference.js')\n\n/**\n * @module _analysis 提交统计信息模块\n * @param {String} functionID 模块ID，例如 quick_edit\n */\nconst _analysis = function (functionID) {\n  if (preference.get('shareMyInfo') !== true) {\n    return\n  }\n  var submitdata = {\n    action: 'submit',\n    url: config.wgServer + config.wgArticlePath.replace('$1', ''),\n    sitename: config.wgSiteName,\n    username: config.wgUserName,\n    function: functionID,\n  }\n  $.ajax({\n    url: api.analysis,\n    data: submitdata,\n    type: 'post',\n    dataType: 'json',\n  }).done(function (data) {\n    console.log(\n      '[InPageEdit] Analysis response\\nStatus: ' +\n        data.status +\n        '\\nMessage: ' +\n        data.msg\n    )\n  })\n}\n\nmodule.exports = {\n  _analysis,\n}\n","/**\n * @module _elements 常用html元素\n */\n\nvar { getUrl } = mw.util\n\nvar $br = '<br>'\nvar $button = ({ type, text, html, href, link }) => {\n  html = html || text\n  href = href || link\n  var $btn = $('<button>', { class: type ? 'btn btn-' + type : 'btn', html })\n  if (href || link) {\n    var target = ''\n    if (/^https?:\\/\\//.test(href)) target = '_blank'\n    var $a = $('<a>', { target, href })\n    $btn.appendTo($a)\n  }\n  return $btn\n}\nvar $hr = '<hr>'\nvar $link = ({ page, link, href, text, html }) => {\n  href = href || link || 'javascript:void(0);'\n  if (page) href = getUrl(page)\n  html = html || text\n  if (page && !html) html = page\n  if (!html) html = href\n  var target = ''\n  if (/^https?:\\/\\//.test(href)) target = '_blank'\n  return $('<a>', { href, target, html })\n}\nvar $progress =\n  '<div class=\"ipe-progress\" style=\"width: 100%\"><div class=\"ipe-progress-bar\"></div></div>'\nvar $checkbox = ({ label, checked, id, className }) => {\n  return $('<label>', { class: className })\n    .append(\n      $('<input>', { type: 'checkbox', checked, id }),\n      $('<span>', { class: 'ipe-checkbox-box' }),\n      $('<span>', { html: label })\n    )\n    .css({\n      display: 'block',\n    })\n}\n\nmodule.exports = {\n  $br,\n  br: $br,\n  $button,\n  $hr,\n  hr: $hr,\n  $link,\n  $progress,\n  progress: $progress,\n  $checkbox,\n}\n","var config = mw.config.get()\n\n/**\n * @module _hasRight 是否拥有权限\n * @param {String} right\n * @return {Boolean}\n */\nconst _hasRight = function (right) {\n  if (config.wgUserIsBlocked === true) {\n    return false\n  }\n  if (mw.config.get('wgUserRights').indexOf(right) > -1) {\n    return true\n  } else {\n    return false\n  }\n}\n\nmodule.exports = {\n  _hasRight,\n}\n","const funcName = 'InPageEdit'\nconst userLang = mw.config.get('wgUserLanguage')\nconst fallbacks = {\n  ab: 'ru',\n  ace: 'id',\n  aln: 'sq',\n  als: 'gsw',\n  an: 'es',\n  anp: 'hi',\n  arn: 'es',\n  arz: 'ar',\n  av: 'ru',\n  ay: 'es',\n  ba: 'ru',\n  bar: 'de',\n  'bat-smg': 'sgs',\n  bcc: 'fa',\n  'be-x-old': 'be-tarask',\n  bh: 'bho',\n  bjn: 'id',\n  bm: 'fr',\n  bpy: 'bn',\n  bqi: 'fa',\n  bug: 'id',\n  'cbk-zam': 'es',\n  ce: 'ru',\n  ckb: 'ckb-arab',\n  crh: 'crh-latn',\n  'crh-cyrl': 'ru',\n  csb: 'pl',\n  cv: 'ru',\n  'de-at': 'de',\n  'de-ch': 'de',\n  'de-formal': 'de',\n  dsb: 'de',\n  dtp: 'ms',\n  eml: 'it',\n  ff: 'fr',\n  'fiu-vro': 'vro',\n  frc: 'fr',\n  frp: 'fr',\n  frr: 'de',\n  fur: 'it',\n  gag: 'tr',\n  gan: 'gan-hant',\n  'gan-hans': 'zh-hans',\n  'gan-hant': 'zh-hant',\n  gl: 'pt',\n  glk: 'fa',\n  gn: 'es',\n  gsw: 'de',\n  hif: 'hif-latn',\n  hsb: 'de',\n  ht: 'fr',\n  ii: 'zh-cn',\n  inh: 'ru',\n  iu: 'ike-cans',\n  jut: 'da',\n  jv: 'id',\n  kaa: 'kk-latn',\n  kbd: 'kbd-cyrl',\n  'kbd-cyrl': 'ru',\n  khw: 'ur',\n  kiu: 'tr',\n  kk: 'kk-cyrl',\n  'kk-arab': 'kk-cyrl',\n  'kk-cn': 'kk-arab',\n  'kk-kz': 'kk-cyrl',\n  'kk-latn': 'kk-cyrl',\n  'kk-tr': 'kk-latn',\n  kl: 'da',\n  koi: 'ru',\n  'ko-kp': 'ko',\n  krc: 'ru',\n  ks: 'ks-arab',\n  ksh: 'de',\n  ku: 'ku-latn',\n  'ku-arab': 'ckb',\n  kv: 'ru',\n  lad: 'es',\n  lb: 'de',\n  lbe: 'ru',\n  lez: 'ru',\n  li: 'nl',\n  lij: 'it',\n  liv: 'et',\n  lmo: 'it',\n  ln: 'fr',\n  ltg: 'lv',\n  lzz: 'tr',\n  mai: 'hi',\n  'map-bms': 'jv',\n  mg: 'fr',\n  mhr: 'ru',\n  min: 'id',\n  mo: 'ro',\n  mrj: 'ru',\n  mwl: 'pt',\n  myv: 'ru',\n  mzn: 'fa',\n  nah: 'es',\n  nap: 'it',\n  nds: 'de',\n  'nds-nl': 'nl',\n  'nl-informal': 'nl',\n  no: 'nb',\n  os: 'ru',\n  pcd: 'fr',\n  pdc: 'de',\n  pdt: 'de',\n  pfl: 'de',\n  pms: 'it',\n  // 'pt': 'pt-br',\n  'pt-br': 'pt',\n  qu: 'es',\n  qug: 'qu',\n  rgn: 'it',\n  rmy: 'ro',\n  rue: 'uk',\n  ruq: 'ruq-latn',\n  'ruq-cyrl': 'mk',\n  'ruq-latn': 'ro',\n  sa: 'hi',\n  sah: 'ru',\n  scn: 'it',\n  sg: 'fr',\n  sgs: 'lt',\n  shi: 'ar',\n  simple: 'en',\n  sli: 'de',\n  sr: 'sr-ec',\n  srn: 'nl',\n  stq: 'de',\n  su: 'id',\n  szl: 'pl',\n  tcy: 'kn',\n  tg: 'tg-cyrl',\n  tt: 'tt-cyrl',\n  'tt-cyrl': 'ru',\n  ty: 'fr',\n  udm: 'ru',\n  ug: 'ug-arab',\n  uk: 'ru',\n  vec: 'it',\n  vep: 'et',\n  vls: 'nl',\n  vmf: 'de',\n  vot: 'fi',\n  vro: 'et',\n  wa: 'fr',\n  wo: 'fr',\n  wuu: 'zh-hans',\n  xal: 'ru',\n  xmf: 'ka',\n  yi: 'he',\n  za: 'zh-hans',\n  zea: 'nl',\n  zh: 'zh-hans',\n  'zh-classical': 'lzh',\n  'zh-cn': 'zh-hans',\n  'zh-hant': 'zh-hans',\n  'zh-hk': 'zh-hant',\n  'zh-min-nan': 'nan',\n  'zh-mo': 'zh-hk',\n  'zh-my': 'zh-sg',\n  'zh-sg': 'zh-hans',\n  'zh-tw': 'zh-hant',\n  'zh-yue': 'yue',\n}\n\n/**\n * @function toObject\n * @param {String} data\n */\nfunction toObject(data) {\n  try {\n    return JSON.parse(data)\n  } catch (e) {\n    return {}\n  }\n}\n\n/**\n * Substitute arguments into the string, where arguments are represented\n * as $n where n > 0.\n *\n * @param message The message to substitute arguments into\n * @param arguments The arguments to substitute in.\n *\n * @return The resulting message.\n */\nfunction handleArgs(message, ...args) {\n  args.forEach(function (elem, index) {\n    var rgx = new RegExp('\\\\$' + (index + 1), 'g')\n    message = message.replace(rgx, elem)\n  })\n\n  return message\n}\n\n/**\n * Generate a HTML link using the supplied parameters.\n *\n * @param href The href of the link which will be converted to\n *     '/wiki/href'.\n * @param text The text and title of the link. If this is not supplied, it\n *     will default to href.\n * @param hasProtocol True if the href parameter already includes the\n *     protocol (i.e. it begins with 'http://', 'https://', or '//').\n *\n * @return The generated link.\n */\nfunction makeLink(href, text, hasProtocol, blank) {\n  text = text || href\n  href = hasProtocol ? href : mw.util.getUrl(href)\n\n  text = mw.html.escape(text)\n  href = mw.html.escape(href)\n\n  blank = blank ? 'target=\"_blank\"' : ''\n\n  return (\n    '<a href=\"' + href + '\" title=\"' + text + '\"' + blank + '>' + text + '</a>'\n  )\n}\n\n/*\n * Allow basic inline HTML tags in wikitext.does not support <a> as that's handled by the\n * wikitext links instead.\n *\n * Supports the following tags:\n * - <i>\n * - <b>\n * - <s>\n * - <br>\n * - <em>\n * - <hr>\n * - <strong>\n * - <span>\n *\n * Supports the following tag attributes:\n * - title\n * - style\n * - class\n *\n * @param html\n *\n * @return\n */\nfunction sanitiseHtml(html) {\n  var context = document.implementation.createHTMLDocument(''),\n    $html = $.parseHTML(html, /* document */ context, /* keepscripts */ false),\n    $div = $('<div>', context).append($html),\n    whitelistAttrs = ['title', 'style', 'class'],\n    whitelistTags = [\n      'b',\n      'br',\n      'code',\n      'del',\n      'em',\n      'hr',\n      'i',\n      's',\n      'strong',\n      'span',\n    ]\n\n  $div.find('*').each(function () {\n    var $this = $(this),\n      tagname = $this.prop('tagName').toLowerCase(),\n      attrs,\n      array,\n      style\n\n    if (whitelistTags.indexOf(tagname) === -1) {\n      mw.log('[I18n-js] Disallowed tag in message: ' + tagname)\n      $this.remove()\n      return\n    }\n\n    attrs = $this.prop('attributes')\n    array = Array.prototype.slice.call(attrs)\n\n    array.forEach(function (attr) {\n      if (whitelistAttrs.indexOf(attr.name) === -1) {\n        mw.log(\n          '[I18n-js] Disallowed attribute in message: ' +\n            attr.name +\n            ', tag: ' +\n            tagname\n        )\n        $this.removeAttr(attr.name)\n        return\n      }\n\n      // make sure there's nothing nasty in style attributes\n      if (attr.name === 'style') {\n        style = $this.attr('style')\n\n        if (style.indexOf('url(') > -1) {\n          mw.log('[I18n-js] Disallowed url() in style attribute')\n          $this.removeAttr('style')\n\n          // https://phabricator.wikimedia.org/T208881\n        } else if (style.indexOf('var(') > -1) {\n          mw.log('[I18n-js] Disallowed var() in style attribute')\n          $this.removeAttr('style')\n        }\n      }\n    })\n  })\n\n  return $div.prop('innerHTML')\n}\n\n/*\n * Parse some basic wikitext into HTML. Also supports basic inline HTML tags.\n *\n * Will process:\n * - http/https\n * - [url text]\n * - [[pagename]]\n * - [[pagename|text]]\n * - {{PLURAL:count|singular|plural}}\n * - {{GENDER:gender|masculine|feminine|neutral}}\n *\n * @param message The message to process.\n *\n * @return The resulting string.\n */\nfunction parseWikitext(message) {\n  // [url text] -> [$1 $2]\n  var urlRgx = /\\[((?:https?:)?\\/\\/.+?) (.+?)\\]/g,\n    // [[pagename]] -> [[$1]]\n    simplePageRgx = /\\[\\[([^|]*?)\\]\\]/g,\n    // [[pagename|text]] -> [[$1|$2]]\n    pageWithTextRgx = /\\[\\[(.+?)\\|(.+?)\\]\\]/g,\n    // {{PLURAL:count|singular|plural}} -> {{PLURAL:$1|$2}}\n    pluralRgx = /\\{\\{PLURAL:(\\d+)\\|(.+?)\\}\\}/gi,\n    // {{GENDER:gender|masculine|feminine|neutral}} -> {{GENDER:$1|$2}}\n    genderRgx = /\\{\\{GENDER:([^|]+)\\|(.+?)\\}\\}/gi\n\n  if (message.indexOf('<') > -1) {\n    message = sanitiseHtml(message)\n  }\n\n  return (\n    message\n      .replace(urlRgx, function (_match, href, text) {\n        return makeLink(href, text, true, true)\n      })\n      // .replace(httpRgx, function (_match, before, href, after) {\n      //   return before + makeLink(href, href, true, true) + after;\n      // })\n      .replace(simplePageRgx, function (_match, href) {\n        return makeLink(href)\n      })\n      .replace(pageWithTextRgx, function (_match, href, text) {\n        return makeLink(href, text)\n      })\n      .replace(pluralRgx, function (_match, count, forms) {\n        return mw.language.convertPlural(Number(count), forms.split('|'))\n      })\n      .replace(genderRgx, function (_match, gender, forms) {\n        return mw.language.gender(gender, forms.split('|'))\n      })\n  )\n}\n\n/**\n * @function parseMessage\n * @param {String} msg\n * @param  {...Sting} args\n */\nfunction parseMessage(msg, ...args) {\n  msg = handleArgs(msg, ...args)\n  msg = parseWikitext(msg)\n  return msg\n}\n\n/**\n * @function rawMessage\n */\nfunction getMessage(lang, msgKey, ...args) {\n  const i18nCache =\n    localStorage.getItem('i18n-cache-' + funcName + '-content') || '{}'\n\n  // qqx\n  if (lang === 'qqx') {\n    var after = ''\n    if (args.length > 0) {\n      after = ': ' + args.join(', ')\n    }\n    return `(${funcName.toLowerCase()}-${msgKey}${after})`\n  }\n\n  // 获取 i18n\n  var cacheMessages = toObject(i18nCache)\n\n  // 查询本地覆写\n  var ipe = window.InPageEdit || {}\n  var overrides = ipe.i18n || {}\n  // InPageEdit.i18n.lang.msgKey\n  if (overrides[lang] && overrides[lang][msgKey]) {\n    return parseMessage(overrides[lang][msgKey], ...args)\n  }\n  // InPageEdit.i18n.msgKey\n  if (overrides[msgKey]) {\n    return parseMessage(overrides[msgKey], ...args)\n  }\n\n  // 查询用户语言\n  if (cacheMessages[lang] && cacheMessages[lang][msgKey]) {\n    return parseMessage(cacheMessages[lang][msgKey], ...args)\n  }\n\n  // 如果到了这一步，意味着消息不存在\n  if (lang === 'en') {\n    return `<${funcName}-${msgKey}>`\n  }\n\n  // 转换用户语言后再试，例如 zh => zh-hans, zh-tw => zh-hant\n  lang = fallbacks[lang] || 'en'\n  return getMessage(lang, msgKey, ...args)\n}\n\n/**\n * @module _msg\n * @param {String} msgKey 消息的键\n * @param  {String} args 替代占位符($1, $2...)的内容，可以解析简单的wikitext\n */\nvar _msg = function (msgKey, ...args) {\n  return getMessage(userLang, msgKey, ...args)\n}\n\nmodule.exports = {\n  _msg,\n}\n","const { _msg } = require('./_msg')\nconst { _hasRight } = require('./_hasRight')\n\nconst { quickDelete } = require('./quickDelete')\nconst { quickEdit } = require('./quickEdit')\n\n/**\n * @module _resolveExists 解决目标页面已存在的问题\n * @param {String} page 需要解决的页面\n * @param {Object|String} reason 填字符串则直接指定两种原因\n * @param {String} reason.delete 删除原因\n * @param {String} reason.edit 编辑原因\n */\nvar _resolveExists = function (page, reason = {}) {\n  var canDelete = _hasRight('delete')\n\n  if (typeof reason === 'string') {\n    reason = {\n      delete: reason,\n      edit: reason,\n    }\n  }\n\n  ssi_modal.show({\n    className: 'in-page-edit resovle-exists',\n    sizeClass: 'dialog',\n    center: true,\n    outSideClose: false,\n    title: _msg('target-exists-title'),\n    content: _msg(\n      canDelete ? 'target-exists-can-delete' : 'target-exists-no-delete',\n      page\n    ),\n    buttons: [\n      {\n        className: 'btn btn-danger btn-exists-delete-target',\n        label: _msg('quick-delete'),\n        method(a, modal) {\n          modal.close()\n          quickDelete(page, reason.delete || null)\n        },\n      },\n      {\n        className: 'btn btn-primary',\n        label: _msg('quick-edit'),\n        method() {\n          quickEdit({\n            page: page,\n            summary: reason.edit ? '[InPageEdit] ' + reason : null,\n            reload: false,\n          })\n        },\n      },\n      {\n        className: 'btn btn-secondary' + (canDelete ? ' btn-single' : ''),\n        label: _msg('cancel'),\n        method: (a, modal) => {\n          modal.close()\n        },\n      },\n    ],\n    onShow: () => {\n      if (!canDelete) {\n        $('.btn-exists-delete-target').hide()\n      }\n    },\n  })\n}\n\nmodule.exports = {\n  _resolveExists,\n}\n","const { _msg } = require('./_msg')\n\nconst api = require('./api.json')\n\n/**\n * @module about 关于插件模块\n * @description Show \"What is\" modal box of IPE2\n */\nvar about = function () {\n  ssi_modal.show({\n    title: _msg('preference-about-label'),\n    className: 'in-page-edit in-page-edit-about',\n    content: $('<section>').append(\n      $('<iframe>', {\n        style: 'margin: 0;padding: 0;width: 100%;height: 80vh;border: 0;',\n        src: api.aboutUrl,\n      })\n    ),\n  })\n}\n\nmodule.exports = {\n  about,\n}\n","var config = mw.config.get()\nconst { _msg } = require('./_msg')\n\nconst { preference } = require('./preference')\nconst { quickEdit } = require('./quickEdit')\n\nconst { getParamValue } = mw.util\n\n/**\n * @module articleLink 获取段落编辑以及编辑链接\n * @param {Sting|Element} el jQuery element to find edit links\n */\nvar articleLink = function (el) {\n  if (el === undefined) {\n    if (preference.get('redLinkQuickEdit') === true) {\n      el = $('#mw-content-text a')\n    } else {\n      el = $('#mw-content-text a:not(.new)')\n    }\n  }\n  el = $(el)\n  $.each(el, function (_, item) {\n    var $this = $(item)\n    if ($this.attr('href') === undefined) return\n    var url = $this.attr('href'),\n      action = getParamValue('action', url) || getParamValue('veaction', url),\n      title = getParamValue('title', url),\n      section = getParamValue('section', url)\n        ? getParamValue('section', url).replace(/T-/, '')\n        : null,\n      revision = getParamValue('oldid', url)\n\n    // 不是本地编辑链接\n    if (!RegExp('^' + config.wgServer).test(url) && !RegExp('^/').test(url))\n      return\n\n    // 不是 index.php?title=FOO 形式的url\n    if (title === null) {\n      title = url.replace(config.wgServer, '')\n      title = title.split('?')[0]\n      title = title.replace(config.wgArticlePath.replace('$1', ''), '')\n    }\n\n    if (action === 'edit' && title !== undefined) {\n      $this.addClass('ipe-articleLink-resolved').after(\n        $('<span>', {\n          class: 'in-page-edit-article-link-group',\n        }).append(\n          $('<a>', {\n            href: 'javascript:void(0)',\n            class: 'in-page-edit-article-link',\n            text: _msg('quick-edit'),\n          }).click(function () {\n            var options = {}\n            options.page = decodeURI(title)\n            if (revision !== null) {\n              options.revision = revision\n            } else if (section !== null) {\n              options.section = section\n            }\n            if (!config.wgIsArticle) options.reload = false\n            quickEdit(options)\n          })\n        )\n      )\n    }\n  })\n}\n\nmodule.exports = {\n  articleLink,\n}\n","const { _msg } = require('./_msg')\nconst { $br } = require('./_elements')\n\n/**\n * @module findAndReplace 查找替换模块\n * @param {element} element Textarea\n */\nfunction findAndReplace(element) {\n  if (element === undefined)\n    element = $('.in-page-edit.ipe-editor:last .editArea')\n  var origin = element.val()\n\n  ssi_modal.show({\n    className: 'in-page-edit',\n    sizeClass: 'dialog',\n    center: true,\n    outSideClose: false,\n    // position: 'right bottom',\n    title: _msg('fAndR-title'),\n    content: $('<div>', { class: 'module far-module' }).append(\n      $('<div>', { class: 'module_content', id: 'findfielddiv' }).append(\n        $('<section>').append(\n          $('<h4>', { text: _msg('fAndR-find-text') }),\n          $('<textarea>', { id: 'find_this', style: 'margin: 0', rows: 4 }),\n          $('<h4>', { text: _msg('fAndR-replace-text') }),\n          $('<textarea>', { id: 'replace_with', style: 'margin: 0', rows: 4 })\n        ),\n        $('<section>', { style: 'padding: 7px 0' }).append(\n          $('<label>').append(\n            $('<input>', { type: 'checkbox', id: 'globl', checked: '' }),\n            $('<span>', { text: _msg('fAndR-globl') })\n          ),\n          $br,\n          $('<label>').append(\n            $('<input>', { type: 'checkbox', id: 'case_sen' }),\n            $('<span>', { text: _msg('fAndR-case-sen') })\n          ),\n          $br,\n          $('<label>').append(\n            $('<input>', { type: 'checkbox', id: 'regex_search' }),\n            $('<span>', { text: _msg('fAndR-enable-regex') })\n          )\n        )\n      )\n    ),\n    buttons: [\n      {\n        label: _msg('fAndR-button-undo'),\n        className: 'btn btn-danger',\n        method() {\n          element.val(origin)\n          ssi_modal.notify('info', {\n            className: 'in-page-edit',\n            title: _msg('notify-info'),\n            content: _msg('notify-fAndR-undo'),\n          })\n          // modal.close();\n        },\n      },\n      {\n        className: 'btn btn-primary',\n        label: _msg('fAndR-button-replace'),\n        method() {\n          /**\n           * 查找替换主函数\n           * 借鉴：https://dev.fandom.com/wiki/MediaWiki:FindAndReplace/code.js\n           **/\n          if ($('#find_this').val() === '') return\n          var searchfor = '',\n            searchexp,\n            $textarea = element,\n            replacewith = $('#replace_with').val().replace(/\\r/gi, ''),\n            text = $textarea.val().replace(/\\r/gi, ''),\n            flagg = 'g',\n            flagi = 'i',\n            enableregex = 0\n\n          if ($('#globl').prop('checked') === false) {\n            flagg = ''\n          }\n          if ($('#case_sen').prop('checked') === true) {\n            flagi = ''\n          }\n          if ($('#regex_search').prop('checked') === true) {\n            enableregex = 1\n          }\n          var flags = flagg + flagi + 'm'\n          if (enableregex === 1) {\n            searchfor = $('#find_this').val()\n          } else {\n            searchfor = $('#find_this')\n              .val()\n              .replace(/\\r/gi, '')\n              .replace(/([.*+?^=!:${}()|[\\]/\\\\])/g, '\\\\$1')\n          }\n          searchexp = new RegExp(searchfor, flags)\n          var rcount = 0\n          var matched = text.match(searchexp)\n          if (matched !== null) {\n            rcount = matched.length\n          }\n          text = text.replace(searchexp, replacewith)\n          $textarea.val(text)\n          ssi_modal.notify('success', {\n            className: 'in-page-edit',\n            title: _msg('notify-success'),\n            content: _msg('notify-fAndR-done', rcount),\n          })\n          // modal.close();\n        },\n      },\n    ],\n  })\n}\n\nmodule.exports = {\n  findAndReplace,\n}\n","/**\n * @module linksHere\n */\n\nconst { quickEdit } = require('./quickEdit')\nconst { _analysis } = require('./_analysis')\nconst { $progress, $link } = require('./_elements')\nconst { _msg } = require('./_msg')\n\nvar mwApi = new mw.Api()\nvar config = mw.config.get()\n\n/**\n * @function isFile\n * @returns {Boolean} Is file page?\n */\nvar isFile = title => {\n  var fileReg = new RegExp(`^(File|${config.wgFormattedNamespaces[6]}):`)\n  return fileReg.test(title)\n}\n\n/**\n * @function getList\n * @param {Sting} title\n */\nvar getList = title => {\n  var opt = {\n    format: 'json',\n    action: 'query',\n    prop: isFile(title) ? 'fileusage' : 'linkshere',\n    titles: title,\n  }\n  if (isFile(title)) {\n    opt.fulimit = 'max'\n  } else {\n    opt.lhlimit = 'max'\n  }\n  return mwApi.get(opt)\n}\n\n/**\n * @function makeList\n * @param {Object} list\n */\nvar makeList = list => {\n  var $list = $('<ol>', { class: 'ipe-links-here-list' })\n  $.each(list, (index, { title, redirect }) => {\n    $list.append(\n      $('<li>').append(\n        $link({ page: title }).attr('target', '_blank'),\n        redirect !== undefined\n          ? ' (<i>' + _msg('links-here-isRedirect') + '</i>)'\n          : '',\n        ' (',\n        $link({ text: '← ' + _msg('links-here') }).click(function () {\n          linksHere(title)\n        }),\n        ' | ',\n        $link({ text: _msg('quick-edit') }).click(function () {\n          quickEdit({\n            page: title,\n            require: false,\n          })\n        }),\n        ')'\n      )\n    )\n  })\n  return $list\n}\n\n/**\n * @module linksHere\n * @param {String} title\n */\nasync function linksHere(title = config.wgPageName) {\n  _analysis('linkshere')\n\n  if (!title || typeof title !== 'string') title = config.wgPageName\n\n  // 构建内容\n  var $progressBar = $($progress)\n  var $content = $('<div>').append($progressBar)\n\n  // 构建模态框\n  var modal = ssi_modal\n    .createObject({\n      className: 'in-page-edit ipe-links-here',\n      center: true,\n      sizeClass: 'dialog',\n      onShow(modal) {\n        mw.hook('InPageEdit.linksHere').fire({\n          modal,\n          $modal: $('#' + modal.modalId),\n        })\n      },\n    })\n    .init()\n\n  // 设定模态框\n  modal.setTitle(_msg('links-here-title', title, 2))\n  modal.setContent($content)\n\n  // 显示模态框\n  modal.show()\n\n  // 异步操作\n  try {\n    console.info('[InPageEdit] linksHere', '开始获取页面信息')\n    const data = await getList(title)\n    const { pages } = data.query\n    console.info('[InPageEdit] linksHere', '成功获取页面信息')\n    var pageId = Object.keys(pages)[0]\n    var pageList = []\n    // 判定为文件还是一般页面\n    if (isFile(title)) {\n      pageList = pages[pageId].fileusage || []\n    } else {\n      pageList = pages[pageId].linkshere || []\n    }\n    $progressBar.hide()\n    // 如果存在页面，则插入列表，否则显示提示\n    if (pageList.length > 0) {\n      var $list = makeList(pageList)\n      $content.append($list)\n    } else {\n      $content.append(\n        $('<div>', {\n          class: 'ipe-links-here-no-page',\n          html: _msg('links-here-no-page', title),\n        })\n      )\n    }\n    // 配置西文单数名词\n    if (pageList.length < 2) {\n      modal.setTitle(_msg('links-here-title', title, 1))\n    }\n    // pageId 是一个字符串，MediaWiki NM$L\n    // pageId 为 \"-1\" 则意味着请求的页面似乎不存在\n    // 但这不意味着不会有链入页面\n    if (pageId === '-1') {\n      $content.append(\n        $('<div>', {\n          html: _msg('links-here-not-exist', title),\n          class: 'ipe-links-here-not-exist',\n        })\n      )\n    }\n    // 发射钩子\n    mw.hook('InPageEdit.linksHere.pageList').fire(pageList)\n    return pageList\n  } catch (err) {\n    $progressBar.hide()\n    $content.append($('<p>', { class: 'error', html: err }))\n    console.error('[InPageEdit] linksHere', '获取页面信息时出现问题', err)\n    return err\n  }\n}\n\nmodule.exports = {\n  linksHere,\n}\n","var config = mw.config.get()\nconst { _msg } = require('./_msg')\nconst { _analysis } = require('./_analysis')\n\nconst { quickDiff } = require('./quickDiff')\n\n/**\n * @module loadQuickDiff 在特定页面查询差异链接并绑定快速差异\n */\nvar loadQuickDiff = function () {\n  // 最近更改\n  function addLink() {\n    $(\n      '.mw-changeslist-groupdiff, .mw-changeslist-diff, .mw-changeslist-diff-cur, .mw-history-histlinks a'\n    ).unbind('click', ipeDiffLink)\n    var ipeDiffLink = $(\n      '.mw-changeslist-groupdiff, .mw-changeslist-diff, .mw-changeslist-diff-cur, .mw-history-histlinks a'\n    ).click(function (e) {\n      e.preventDefault()\n      _analysis('quick_diff_recentchanges')\n      var $this = $(this),\n        href = $this.attr('href'),\n        diff = mw.util.getParamValue('diff', href),\n        curid = mw.util.getParamValue('curid', href),\n        oldid = mw.util.getParamValue('oldid', href)\n      if (diff === '0') {\n        quickDiff({ fromrev: oldid, toid: curid })\n      } else if (diff === 'prev' || diff === 'next' || diff === 'cur') {\n        quickDiff({ fromrev: oldid, torelative: diff })\n      } else {\n        quickDiff({ fromrev: oldid, torev: diff })\n      }\n    })\n  }\n  if ($('.mw-rcfilters-enabled').length > 0) {\n    setInterval(addLink, 500)\n    $('.mw-rcfilters-enabled').addClass('ipe-continuous-active')\n  } else {\n    addLink()\n  }\n  // 查看历史页面的比较按钮与快速编辑\n  if (config.wgAction === 'history') {\n    $('.historysubmit.mw-history-compareselectedversions-button').after(\n      $('<button>')\n        .text(_msg('quick-diff'))\n        .click(function (e) {\n          e.preventDefault()\n          _analysis('quick_diff_history_page')\n          var before = $('.selected.before').attr('data-mw-revid'),\n            after = $('.selected.after').attr('data-mw-revid')\n          quickDiff({ fromrev: after, torev: before })\n        })\n    )\n    $('[data-mw-revid]').each(function () {\n      var $this = $(this),\n        oldid = $this.attr('data-mw-revid')\n      $this\n        .find('.mw-history-undo')\n        .after(\n          $('<span>').html(\n            ' | <a class=\"in-page-edit-article-link\" href=\"javascript:void(0);\" onclick=\"InPageEdit.quickEdit({page:mw.config.get(\\'wgPageName\\'),revision:' +\n              oldid +\n              '});\">' +\n              _msg('quick-edit') +\n              '</a>'\n          )\n        )\n    })\n  }\n}\n\nmodule.exports = {\n  loadQuickDiff,\n}\n","// const _dir = require('../method/_dir');\n// const { _msg } = require('./_msg');\nconst pluginCDN = require('./api.json').pluginCDN\n\n/**\n * @module pluginStore 加载InPageEdit插件\n */\nvar pluginStore = {\n  /**\n   * @module pluginStore.get 获取官方插件\n   */\n  get() {\n    return $.ajax({\n      url: pluginCDN + '/index.json',\n      dataType: 'json',\n      crossDomain: true,\n      cache: false,\n    })\n  },\n  saveCache(data) {\n    var ipe = window.InPageEdit || {}\n    ipe.cache = ipe.cache || {}\n    ipe.cache.pluginList = data\n    window.InPageEdit = ipe\n  },\n  loadCache() {\n    var ipe = window.InPageEdit || {}\n    ipe.cache = ipe.cache || {}\n    return ipe.cache.pluginList\n  },\n  /**\n   * @module pluginStore.load 载入插件\n   * @param {String} name\n   */\n  load(name) {\n    if (/^https?:\\/\\//.test(name)) {\n      mw.loader.load(name)\n      console.info('[InPageEdit] 从远程加载非官方插件', name)\n    } else {\n      const { loadScript } = require('../method/loadScript')\n      loadScript(pluginCDN + '/plugins/' + name).then(\n        () => console.info('[InPageEdit] 插件 ' + name + ' 加载成功'),\n        err => console.warn('[InPageEdit] 插件 ' + name + ' 加载失败', err)\n      )\n      console.info('[InPageEdit] 从官方插件商店加载插件', name)\n    }\n  },\n  /**\n   * @module pluginStore.initUserPlugin 初始化用户插件\n   */\n  initUserPlugin() {\n    const { preference } = require('./preference')\n    var userPlugins = preference.get('plugins')\n    if (typeof userPlugins === 'object' && userPlugins.length > 0) {\n      $.each(userPlugins, (key, val) => {\n        pluginStore.load(val)\n      })\n    }\n  },\n}\n\nmodule.exports = {\n  pluginStore,\n}\n","/**\n * @module preference 个人设置模块\n */\n\nvar InPageEdit = window.InPageEdit || {}\nvar config = mw.config.get()\n\n// const { _analysis } = require('./_analysis')\nconst { _msg } = require('./_msg')\nconst { $br, $hr, $progress, $checkbox, $button } = require('./_elements')\n\nconst api = require('./api.json')\nconst version = require('./version')\nconst { pluginStore } = require('./pluginStore')\nconst _dir = require('../method/_dir')\nconst { beforeInstall } = require('../method/beforeInstall')\n\n/**\n * @name 预设值\n * @return {object}\n */\nvar defaultSettings = {\n  editMinor: false,\n  editSummary: _msg('preference-summary-default'),\n  lockToolBox: false,\n  redLinkQuickEdit: true,\n  shareMyInfo: false,\n  outSideClose: true,\n  watchList: Boolean(mw.user.options.get('watchdefault')),\n  plugins: ['toolbox.js'],\n}\n/**\n * @name 获取设置\n * @description 合并保存在用户页的设置以及localStorage的设置，有容错机制\n * @param {string} setting 返回相应的设置，为空时返回全部设置\n * @return {object|string}\n */\n\nvar get = setting => {\n  var local = localStorage.getItem('InPageEditPreference') || '{}'\n  try {\n    local = JSON.parse(local)\n  } catch (e) {\n    local = {}\n  }\n  if (typeof InPageEdit.myPreference === 'object') {\n    local = $.extend({}, local, InPageEdit.myPreference)\n  }\n  var json = $.extend({}, defaultSettings, local)\n  if (typeof setting === 'string' && setting !== '') {\n    return json[setting] ? json[setting] : null\n  } else {\n    return json\n  }\n}\n\n/**\n * @name 保存设置\n * @param {Object|string} settingKey\n * @param {any} settingValue\n * @example 可以这样 preference.set({ key: 'value' }) 也可以 preference.set('key', 'value')\n */\nvar set = (settingKey = {}, settingValue = undefined) => {\n  var options = {}\n  if (typeof settingKey === 'string' && settingValue !== undefined) {\n    options[settingKey] = settingValue\n  } else if (typeof settingKey === 'object') {\n    options = settingKey\n  } else {\n    return\n  }\n  options = $.extend({}, preference.get(), options)\n  options = JSON.stringify(options)\n  localStorage.setItem('InPageEditPreference', options)\n}\n\n/**\n * @name 用户图形界面\n * @description 打开可视化设置窗口\n */\nvar modal = () => {\n  // 防止多开设置页面\n  if ($('#ipe-preference-form').length > 0) return\n\n  mw.hook('pluginPreference').fire()\n  preference.set()\n  var local = preference.get()\n  require('./_analysis')._analysis('plugin_setting')\n\n  /** 定义模态框内部结构 */\n  var $tabList = $('<ul>', { class: 'tab-list' }).append(\n    $('<li>').append(\n      $('<a>', { text: _msg('preference-tab-editor'), href: '#editor' })\n    ),\n    $('<li>').append(\n      $('<a>', { text: _msg('preference-tab-plugin'), href: '#plugin' })\n    ),\n    $('<li>').append(\n      $('<a>', { text: _msg('preference-tab-analysis'), href: '#analysis' })\n    ),\n    $('<li>').append(\n      $('<a>', { text: _msg('preference-tab-another'), href: '#another' })\n    ),\n    $('<li>').append(\n      $('<a>', { text: _msg('preference-tab-about'), href: '#about' })\n    )\n  )\n\n  var $tabContent = $('<div>', {\n    class: 'tab-content',\n    style: 'position: relative;',\n  }).append(\n    $('<section>', { id: 'editor' }).append(\n      $('<h3>', { text: _msg('preference-editor-title') }),\n      $('<h4>', { text: _msg('preference-editHobits-label') }),\n      $checkbox({ id: 'editMinor', label: _msg('preference-setMinor') }),\n      $checkbox({ id: 'watchList', label: _msg('preference-watchList') }),\n      $checkbox({\n        id: 'watchoutSideCloseList',\n        label: _msg('preference-outSideClose'),\n      }),\n      $('<h4>', { text: _msg('preference-summary-label') }),\n      $('<label>', {\n        for: 'editSummary',\n        style: 'padding-left: 0; font-size: small',\n        html: _msg('preference-editSummary'),\n      }),\n      $('<input>', {\n        id: 'editSummary',\n        style: 'width: 96%',\n        placeholder: 'Edit via InPageEdit, yeah~',\n      })\n    ),\n    $('<section>', { id: 'plugin' }).append(\n      $('<h3>', { text: _msg('preference-plugin-title') }),\n      $('<div>', {\n        id: 'plugin-container',\n        html: $($progress).css({\n          width: '96%',\n          position: 'absolute',\n          top: '50%',\n          transform: 'translateY(-50%)',\n        }),\n      }),\n      $('<div>', { class: 'plugin-footer' }).html(\n        _msg('preference-plugin-footer', api.pluginGithub)\n      )\n    ),\n    $('<section>', { id: 'analysis' }).append(\n      $('<h3>', { text: _msg('preference-analysis-title') }),\n      $('<div>', {\n        id: 'analysis-container',\n      }).append(\n        $('<label>').append(\n          $('<input>', { type: 'checkbox', id: 'shareMyInfo' }),\n          $('<span>', { html: _msg('preference-analysis-shareMyInfo') })\n        ),\n        $($progress).attr('id', 'analysis-loading').css({\n          width: '96%',\n          position: 'absolute',\n          top: '50%',\n          transform: 'translateY(-50%)',\n        })\n      )\n    ),\n    $('<section>', { id: 'another' }).append(\n      $('<h3>', { text: _msg('preference-another-title') }),\n      $button({ type: 'secondary', text: _msg('beforeInstall-title') })\n        .css({ display: 'block' })\n        .click(function () {\n          beforeInstall(true).then(opt => {\n            set(opt)\n          })\n        }),\n      $('<h4>', { text: _msg('preference-display-label') }),\n      $('<label>').append(\n        $('<input>', { type: 'checkbox', id: 'redLinkQuickEdit' }),\n        $('<span>', { text: _msg('preference-redLinkQuickEdit') })\n      ),\n      $('<div>').append(\n        $('<h4>', { text: 'Custom skin (Not available yet)' }),\n        $('<label>', { class: 'choose-skin' }).append(\n          $('<input>', {\n            type: 'checkbox',\n            id: 'useCustomSkin',\n            disabled: true,\n          }),\n          $('<span>'),\n          $('<input>', {\n            id: 'skinUrl',\n            disabled: true,\n            style: 'width: calc(96% - 30px)',\n            value: _dir + '/src/skin/ipe-default.css',\n          })\n        )\n      ),\n      $('<h4>', { text: _msg('preference-savelocal-popup-title') }),\n      $('<button>', {\n        class: 'btn btn-secondary',\n        id: 'ipeSaveLocalShow',\n        text: _msg('preference-savelocal-btn'),\n      }).click(function () {\n        // 永久保存（本地用户页）\n        var $saveLocalModal = $('<section>').append(\n          _msg('preference-savelocal-popup'),\n          $br,\n          $('<textarea>', {\n            style: 'font-size: 12px; resize: none; width: 100%; height: 10em;',\n            readonly: true,\n          })\n            .click(function () {\n              this.select()\n            })\n            .val(\n              '/** InPageEdit Preferences **/\\n' +\n                'window.InPageEdit = window.InPageEdit || {}; // Keep this line\\n' +\n                'InPageEdit.myPreference = ' +\n                JSON.stringify($modalContent.data(), null, 2)\n            )\n        )\n        ssi_modal.dialog({\n          className: 'in-page-edit',\n          center: true,\n          title: _msg('preference-savelocal-popup-title'),\n          content: $saveLocalModal,\n          okBtn: {\n            className: 'btn btn-primary btn-single',\n            label: _msg('ok'),\n          },\n        })\n      })\n    ),\n    $('<section>', { id: 'about' }).append(\n      $('<h3>', { text: _msg('preference-about-label') }),\n      $('<div>', { style: 'font-size: 12px; font-style: italic;' }).html(\n        function () {\n          var isCanary = /(alpha|beta|pre)/i.test(version)\n          var html = 'v' + version\n          html += isCanary\n            ? ' - You are running the Canary version of InPageEdit<br>' +\n              _msg('version-notice-canary')\n            : ''\n          return html\n        }\n      ),\n      $('<button>', {\n        class: 'btn btn-secondary btn-single',\n        onclick: 'InPageEdit.about()',\n        text: _msg('preference-aboutAndHelp'),\n      }),\n      $('<button>', {\n        class: 'btn btn-secondary btn-single',\n        style: 'margin-top: .5em;',\n        onclick: 'InPageEdit.versionInfo()',\n        text: _msg('preference-updatelog'),\n      }),\n      $('<a>', {\n        href: 'https://ipe.miraheze.org/wiki/',\n        target: '_blank',\n        style: 'margin-top: .5em; display: block;',\n      }).append(\n        $('<button>', {\n          class: 'btn btn-secondary btn-single',\n          text: _msg('preference-translate'),\n        })\n      ),\n      $('<a>', {\n        href: 'https://discord.gg/VUVAh8w',\n        target: '_blank',\n        style: 'margin-top: .5em; display: block;',\n      }).append(\n        $('<button>', {\n          class: 'btn btn-secondary btn-single',\n          text: _msg('preference-discord'),\n        })\n      ),\n      $hr,\n      $('<p>', {\n        text:\n          'InPageEdit is a useful MediaWiki JavaScript Plugin written with jQuery',\n      }),\n      $('<p>').append(\n        '© InPageEdit Copyright (C)',\n        ' 2019 - ' + new Date().getFullYear(),\n        ' Wjghj Project (机智的小鱼君), ',\n        $('<a>', {\n          href: 'https://www.gnu.org/licenses/gpl-3.0-standalone.html',\n          text: 'GNU General Public License 3.0',\n        })\n      )\n    )\n  )\n\n  var $modalContent = $('<div>', { class: 'preference-tabber' }).append(\n    $tabList,\n    $tabContent\n  )\n\n  // 绑定tab-list按钮事件\n  $tabList.find('a').click(function (e) {\n    e.preventDefault()\n    var $this = $(this)\n    var tab = $this.attr('href')\n    if (tab) {\n      $tabList.find('a').removeClass('active')\n      $tabContent.find('section').removeClass('active')\n      $this.addClass('active')\n      $tabContent.find('' + tab).addClass('active')\n    }\n  })\n\n  // 设定input状态\n  // ...\n\n  // 绑定input事件\n  $tabContent.find('input').change(function () {\n    var $this = $(this)\n    var key = $this.attr('id')\n    var val\n    if ($this.prop('type') === 'checkbox') {\n      val = $this.prop('checked')\n    } else {\n      val = $this.val()\n    }\n    $modalContent.data(key, val)\n    console.log('[InPageEdit] Preset preference', $modalContent.data())\n  })\n\n  // 预先选中第一个tab\n  $tabList.find('a:first').addClass('active')\n  $tabContent.find('section:first').addClass('active')\n\n  // 显示模态框\n  ssi_modal.show({\n    sizeClass: 'dialog',\n    className: 'in-page-edit ipe-preference',\n    outSideClose: false,\n    title: _msg('preference-title') + ' - ' + version,\n    content: $modalContent,\n    buttons: [\n      {\n        label: _msg('preference-reset'),\n        className: 'btn btn-danger',\n        method: function (a, modal) {\n          ssi_modal.confirm(\n            {\n              title: _msg('preference-reset-confirm-title'),\n              content: _msg('preference-reset-confirm'),\n              className: 'in-page-edit',\n              center: true,\n              okBtn: {\n                label: _msg('ok'),\n                className: 'btn btn-danger',\n              },\n              cancelBtn: {\n                label: _msg('cancel'),\n                className: 'btn',\n              },\n            },\n            res => {\n              if (res) {\n                preference.set(defaultSettings)\n                modal.close()\n              } else {\n                return false\n              }\n            }\n          )\n        },\n      },\n      {\n        label: _msg('preference-save'),\n        className: 'btn btn-primary',\n        method: function (a, modal) {\n          preference.set($modalContent.data())\n          // console.info('[InPageEdit] Set preference', $modalContent.data())\n          modal.close()\n        },\n      },\n    ],\n    onShow($modal) {\n      var $modalWindow = $('#' + $modal.modalId)\n      mw.hook('InPageEdit.preference.modal').fire({\n        $modal,\n        $modalWindow,\n      })\n\n      // 如果在本地有设定存档，disable掉全部input\n      function setDisabled(obj, isArr) {\n        $.each(obj, (key, val) => {\n          if (typeof val === 'object') {\n            setDisabled(val, true)\n          } else if (isArr) {\n            // document.getElementById(val).disabled = true\n            $modalWindow.find(`[id=\"${val}\"]`).attr('disabled', true)\n          } else {\n            // document.getElementById(key).disabled = true\n            $modalWindow.find(`[id=\"${key}\"]`).attr('disabled', true)\n          }\n        })\n      }\n      if (typeof InPageEdit.myPreference !== 'undefined') {\n        // $modalWindow.find('.ssi-modalBtn.btn').attr({ disabled: true })\n        setDisabled(InPageEdit.myPreference)\n        $tabList.before(\n          $('<div>', {\n            class: 'has-local-warn',\n            style:\n              'padding-left: 8px; border-left: 6px solid orange; font-size: small;',\n            html: _msg('preference-savelocal-popup-haslocal'),\n          })\n        )\n      }\n\n      // 将现有设定反映到选项中\n      $.each(local, (key, val) => {\n        if (key === 'plugins') {\n          $modalContent.data(key, val)\n          return\n        }\n        var $input = $tabContent.find('#' + key)\n        if ($input.length > 0) {\n          $modalContent.data(key, val)\n          if (typeof val === 'string') {\n            $input.val(val)\n          }\n          if (typeof val === 'boolean') {\n            $input.prop('checked', val)\n          }\n        }\n      })\n\n      // 获取插件列表\n      var usedPlugin = preference.get('plugins')\n      var pluginCache = pluginStore.loadCache()\n      if (pluginCache) {\n        showPluginList(pluginCache)\n      } else {\n        pluginStore.get().then(list => {\n          pluginStore.saveCache(list)\n          showPluginList(list)\n        })\n      }\n      function showPluginList(list) {\n        $tabContent.find('#plugin-container').html($('<ul>'))\n        $.each(list, (key, val) => {\n          var name = val.name || 'Unknown'\n          var description = val.description || ''\n          var author = val.author\n            ? $('<a>', {\n                href: 'https://gtihub.com/' + val.author,\n                target: '_balnk',\n                text: '@' + val.author,\n              })\n            : '-'\n          $tabContent.find('#plugin-container > ul').append(\n            $('<li>').append(\n              $('<label>').append(\n                $('<input>', {\n                  class: 'plugin-checkbox',\n                  id: key,\n                  type: 'checkbox',\n                  checked: Boolean(\n                    usedPlugin.indexOf(key) >= 0 || val._force === true\n                  ), // 勾选当前正在使用以及强制启用的插件\n                  disabled:\n                    typeof InPageEdit.myPreference !== 'undefined' ||\n                    val._force === true, // 强制启用或者本地保存设定时禁止改变\n                }).change(function () {\n                  // 当插件选择框变化时，暂存设定档\n                  var $this = $(this)\n                  var checked = $this.prop('checked')\n                  var original = $modalContent.data('plugins')\n                  var index = original.indexOf(key)\n                  // 勾选且暂未启用\n                  if (checked && index < 0) {\n                    original.push(key)\n                  }\n                  // 取消勾选且已启用\n                  if (!checked && index >= 0) {\n                    original.splice(index, 1)\n                  }\n                  // 暂存\n                  $modalContent.data('plugins', original)\n                }),\n                $('<span>'), // checkbox框框\n                $('<div>', { class: 'plugin-name', text: name }),\n                $('<div>', { class: 'plugin-author', html: author }),\n                $('<div>', { class: 'plugin-description', text: description })\n              )\n            )\n          )\n        })\n      }\n\n      // 获取Analysis数据\n      var userName = config.wgUserName\n      $.get('https://api.wjghj.cn/inpageedit/query/wiki', {\n        url: config.wgServer + config.wgArticlePath.replace('$1', ''),\n        prop: 'users.' + userName + '._total|users.' + userName + '.functions',\n      }).then(ret => {\n        $tabContent.find('#analysis-container #analysis-loading').hide()\n        var data = ret.query[0].users[userName]\n        var total = data._total\n        var functionData = data.functions\n        var functionList = $('<table>', {\n          class: 'wikitable',\n          style: 'width: 96%',\n        }).append(\n          $('<tr>').append(\n            $('<th>', { text: 'ID' }),\n            $('<th>', { text: 'Times' }),\n            $('<th>', { text: 'Percents' })\n          )\n        )\n        $.each(functionData, (key, val) => {\n          functionList.append(\n            $('<tr>').append(\n              $('<th>', { text: key }),\n              $('<td>', { text: val }),\n              $('<td>', { text: ((val / total) * 100).toFixed(2) + '%' })\n            )\n          )\n        })\n        $tabContent.find('#analysis-container').append(\n          $('<h4>', {\n            text: config.wgUserName + ' - ' + config.wgSiteName,\n          }),\n          $('<p>').append(_msg('preference-analysis-totaluse', total)),\n          functionList\n        )\n      })\n    },\n  })\n}\n\nvar preference = {\n  default: defaultSettings,\n  defaultSettings,\n  set,\n  get,\n  modal,\n}\n\nmodule.exports = {\n  preference,\n}\n","const { _msg } = require('./_msg')\n\nconst { $progress } = require('./_elements.js')\n\n/**\n * @module progress 载入中模块\n * @param {Boolean|String} title\n * @default \"Loading...\"\n * @returns\n * - true: Mark top progress box as done\n * - false: Close top progress box\n * - String: Show new progress box with title\n */\nvar progress = function (title) {\n  if (title === true) {\n    $('.in-page-edit.loadingbox .ssi-modalTitle').html(_msg('done'))\n    $('.in-page-edit.loadingbox .ipe-progress').addClass('done')\n  } else if (title === false) {\n    if ($('.in-page-edit.loadingbox').length > 0) {\n      $('.in-page-edit.loadingbox').appendTo('body')\n      ssi_modal.close()\n    }\n  } else {\n    if ($('.in-page-edit.loadingbox').length > 0) return\n    if (typeof title === 'undefined') {\n      title = 'Loading...'\n    }\n    ssi_modal.show({\n      title: title,\n      content: $progress,\n      className: 'in-page-edit loadingbox',\n      center: true,\n      sizeClass: 'dialog',\n      closeIcon: false,\n      outSideClose: false,\n    })\n  }\n}\n\nmodule.exports = {\n  progress,\n}\n","var mwApi = new mw.Api()\nvar config = mw.config.get()\nconst { _analysis } = require('./_analysis')\nconst { _msg } = require('./_msg')\nconst { _hasRight } = require('./_hasRight')\nconst { $br } = require('./_elements')\n\n/**\n * @module quickDelete 删除页面模块\n * @param {String} page\n */\nvar quickDelete = function (page, givenReason = '') {\n  mw.hook('InPageEdit.quickDelete').fire()\n  console.log('Quick delete', page, givenReason)\n  var reason\n  page = page || config.wgPageName\n\n  ssi_modal.show({\n    outSideClose: false,\n    className: 'in-page-edit quick-delete',\n    center: true,\n    sizeClass: 'dialog',\n    title: _msg('delete-title'),\n    content: $('<div>').append(\n      $('<section>', { id: 'InPageEditDeletepage' }).append(\n        $('<span>', {\n          html: _msg('delete-reason', '<b>' + page.replace(/_/g, ' ') + '</b>'),\n        }),\n        $br,\n        $('<label>', { for: 'delete-reason', text: _msg('editSummary') }),\n        $('<input>', {\n          id: 'delete-reason',\n          style: 'width:96%',\n          onclick: \"$(this).css('box-shadow', '')\",\n          value: givenReason,\n        })\n      )\n    ),\n    beforeShow: function () {\n      if (!_hasRight('delete')) {\n        ssi_modal.dialog({\n          title: _msg('notify-no-right'),\n          content: _msg('delete-no-right'),\n          className: 'in-page-edit quick-deletepage',\n          center: true,\n          okBtn: {\n            className: 'btn btn-primary btn-single',\n          },\n        })\n        return false\n      }\n    },\n    buttons: [\n      {\n        label: _msg('cancel'),\n        className: 'btn btn-primary',\n        method: function (e, modal) {\n          modal.close()\n        },\n      },\n      {\n        label: _msg('confirm'),\n        className: 'btn btn-danger',\n        method: function (e, modal) {\n          reason = $('#InPageEditDeletepage #delete-reason').val()\n          if (reason === '') {\n            $('#InPageEditDeletepage #delete-reason').css(\n              'box-shadow',\n              '0 0 4px #f00'\n            )\n            return\n          }\n          _analysis('quick_delete')\n\n          ssi_modal.confirm(\n            {\n              center: true,\n              className: 'in-page-edit',\n              title: _msg('delete-confirm-title'),\n              content: _msg('delete-confirm-content'),\n              okBtn: {\n                label: _msg('confirm'),\n                className: 'btn btn-danger',\n              },\n              cancelBtn: {\n                label: _msg('cancel'),\n                className: 'btn',\n              },\n            },\n            function (result) {\n              if (result) {\n                reason = _msg('delete-title') + ' (' + reason + ')'\n                mwApi\n                  .postWithToken('csrf', {\n                    action: 'delete',\n                    title: page,\n                    reason: reason,\n                    format: 'json',\n                  })\n                  .then(() => {\n                    ssi_modal.notify('success', {\n                      className: 'in-page-edit',\n                      title: _msg('notify-success'),\n                      content: _msg('notify-delete-success', page),\n                    })\n                  })\n                  .fail(function (errorCode, feedback, errorThrown) {\n                    ssi_modal.notify('error', {\n                      className: 'in-page-edit',\n                      title: _msg('notify-error'),\n                      content:\n                        _msg('notify-delete-error') +\n                        ': <br/><span style=\"font-size:amall\">' +\n                        errorThrown.error['*'] +\n                        '(<code>' +\n                        errorThrown.error['code'] +\n                        '</code>)</span>',\n                    })\n                  })\n                modal.close()\n              } else {\n                return false\n              }\n            }\n          )\n        },\n      },\n    ],\n  })\n}\n\nmodule.exports = {\n  quickDelete,\n}\n","var mwApi = new mw.Api()\nvar config = mw.config.get()\n\nconst { _analysis } = require('./_analysis')\nconst { _msg } = require('./_msg')\n\nconst { $br, $progress } = require('./_elements')\n\n/**\n * @module quickDiff 快速页面差异模块\n * @param {Object} param standard MediaWiki API params\n */\nvar quickDiff = function (param) {\n  mw.hook('InPageEdit.quickDiff').fire()\n  _analysis('quick_diff')\n  if ($('[href*=\"mediawiki.diff.styles\"]').length < 1) {\n    mw.loader.load(\n      mw.util.wikiScript('load') +\n        '?modules=mediawiki.legacy.shared|mediawiki.diff.styles&only=styles',\n      'text/css'\n    )\n  }\n  var $modalTitle, $diffArea, $loading\n  if ($('.quick-diff').length > 0) {\n    console.info('[InPageEdit] Quick diff 正在加载新内容')\n    $modalTitle = $('.quick-diff .pageName')\n    $diffArea = $('.quick-diff .diffArea')\n    $loading = $('.quick-diff .ipe-progress')\n    $modalTitle.text(_msg('diff-loading'))\n    $diffArea.hide()\n    $('.quick-diff').appendTo('body')\n  } else {\n    $modalTitle = $('<span>', { class: 'pageName', text: _msg('diff-loading') })\n    $diffArea = $('<div>', { class: 'diffArea', style: 'display: none' })\n    $loading = $($progress)\n\n    ssi_modal.show({\n      className: 'in-page-edit quick-diff',\n      sizeClass: 'large',\n      fixedHeight: true,\n      fitScreen: true,\n      title: $modalTitle,\n      content: $('<div>').append($loading, $diffArea),\n      buttons: [\n        {\n          label: _msg('diff-button-todiffpage'),\n          className: 'btn btn-secondary toDiffPage',\n        },\n      ],\n    })\n  }\n  $loading\n    .show()\n    .css('margin-top', $('.quick-diff .ssi-modalContent').height() / 2)\n  $('.quick-diff .toDiffPage').unbind()\n  param.action = 'compare'\n  param.prop = 'diff|diffsize|rel|ids|title|user|comment|parsedcomment|size'\n  param.format = 'json'\n  if (param.totext) {\n    param.topst = true\n  } else if (param.fromtext) {\n    param.frompst = true\n  }\n  mwApi\n    .post(param)\n    .done(function (data) {\n      var diffTable = data.compare['*']\n      var toTitle\n      $loading.hide()\n      if (param.pageName === undefined) {\n        toTitle = data.compare.totitle\n      } else {\n        toTitle = param.pageName\n      }\n      function userLink(user) {\n        return (\n          '<a class=\"diff-user\" href=\"' +\n          mw.util.getUrl('User:' + user) +\n          '\">' +\n          user +\n          '</a> (<a href=\"' +\n          mw.util.getUrl('User_talk:' + user) +\n          '\">' +\n          _msg('diff-usertalk') +\n          '</a> | <a href=\"' +\n          mw.util.getUrl('Special:Contributions/' + user) +\n          '\">' +\n          _msg('diff-usercontrib') +\n          '</a> | <a href=\"' +\n          mw.util.getUrl('Special:Block/' + user) +\n          '\">' +\n          _msg('diff-userblock') +\n          '</a>)'\n        )\n      }\n      $modalTitle.html(_msg('diff-title') + ': <u>' + toTitle + '</u>')\n      $diffArea\n        .show()\n        .html('')\n        .append(\n          $('<table>', { class: 'diff difftable' }).append(\n            $('<colgroup>').append(\n              $('<col>', { class: 'diff-marker' }),\n              $('<col>', { class: 'diff-content' }),\n              $('<col>', { class: 'diff-marker' }),\n              $('<col>', { class: 'diff-content' })\n            ),\n            $('<tbody>').append(\n              $('<tr>').append(\n                $('<td>', { colspan: 2, class: 'diff-otitle' }).append(\n                  $('<a>', {\n                    href: config.wgScript + '?oldid=' + data.compare.fromrevid,\n                    text: data.compare.fromtitle,\n                  }),\n                  ' (',\n                  $('<span>', {\n                    class: 'diff-version',\n                    text: _msg('diff-version') + data.compare.fromrevid,\n                  }),\n                  ') (',\n                  $('<a>', {\n                    class: 'editLink',\n                    href:\n                      config.wgScript +\n                      '?action=edit&title=' +\n                      data.compare.fromtitle +\n                      '&oldid=' +\n                      data.compare.fromrevid,\n                    text: _msg('diff-edit'),\n                  }),\n                  ')',\n                  $br,\n                  userLink(data.compare.fromuser),\n                  $br,\n                  ' (',\n                  $('<span>', {\n                    class: 'diff-comment',\n                    html: data.compare.fromparsedcomment,\n                  }),\n                  ') ',\n                  $br,\n                  $('<a>', {\n                    class: 'prevVersion ipe-analysis-quick_diff_modalclick',\n                    href: 'javascript:void(0);',\n                    text: '←' + _msg('diff-prev'),\n                  }).click(() => {\n                    quickDiff({\n                      fromrev: data.compare.fromrevid,\n                      torelative: 'prev',\n                    })\n                  })\n                ),\n                $('<td>', { colspan: 2, class: 'diff-ntitle' }).append(\n                  $('<a>', {\n                    href: config.wgScript + '?oldid=' + data.compare.torevid,\n                    text: data.compare.totitle,\n                  }),\n                  ' (',\n                  $('<span>', {\n                    class: 'diff-version',\n                    text: _msg('diff-version') + data.compare.torevid,\n                  }),\n                  ') (',\n                  $('<a>', {\n                    class: 'editLink',\n                    href:\n                      config.wgScript +\n                      '?action=edit&title=' +\n                      data.compare.totitle +\n                      '&oldid=' +\n                      data.compare.torevid,\n                    text: _msg('diff-edit'),\n                  }),\n                  ')',\n                  $br,\n                  userLink(data.compare.touser),\n                  $br,\n                  ' (',\n                  $('<span>', {\n                    class: 'diff-comment',\n                    html: data.compare.toparsedcomment,\n                  }),\n                  ') ',\n                  $br,\n                  $('<a>', {\n                    class: 'nextVersion ipe-analysis-quick_diff_modalclick',\n                    href: 'javascript:void(0);',\n                    text: _msg('diff-nextv') + '→',\n                  }).click(() => {\n                    _analysis('quick_diff_modalclick')\n                    quickDiff({\n                      fromrev: data.compare.torevid,\n                      torelative: 'next',\n                    })\n                  })\n                )\n              ),\n              diffTable,\n              $('<tr>', {\n                class: 'diffSize',\n                style: 'text-align: center',\n              }).append(\n                $('<td>', {\n                  colspan: '2',\n                  text: data.compare.fromsize + _msg('diff-bytes'),\n                }),\n                $('<td>', {\n                  colspan: '2',\n                  text: data.compare.tosize + _msg('diff-bytes'),\n                })\n              )\n            )\n          )\n        )\n      $('.quick-diff button.toDiffPage').click(function () {\n        location.href =\n          config.wgScript +\n          '?oldid=' +\n          data.compare.fromrevid +\n          '&diff=' +\n          data.compare.torevid\n      })\n      require('./articleLink').articleLink($('.quick-diff .editLink'))\n      if (param.isPreview === true) {\n        $('.quick-diff button.toDiffPage').hide()\n        $diffArea\n          .find('.diff-otitle')\n          .html('<b>' + _msg('diff-title-original-content') + '</b>')\n        $diffArea\n          .find('.diff-ntitle')\n          .html('<b>' + _msg('diff-title-your-content') + '</b>')\n      }\n      if (\n        data.compare.fromsize === undefined ||\n        data.compare.tosize === undefined\n      ) {\n        $diffArea.find('.diffSize').hide()\n      }\n      // 无上一版本或下一版本\n      if (data.compare.fromrevid === undefined && param.isPreview !== true) {\n        $diffArea\n          .find('.diff-otitle')\n          .html(\n            '<span class=\"noPrevVerson\">' +\n              data.warnings.compare['*'] +\n              '</span>'\n          )\n      } else if (\n        data.compare.torevid === undefined &&\n        param.isPreview !== true\n      ) {\n        $diffArea\n          .find('.diff-ntitle')\n          .html(\n            '<span class=\"noNextVerson\">' +\n              data.warnings.compare['*'] +\n              '</span>'\n          )\n      }\n      // GitHub@issue#5 修复被隐藏版本的问题\n      if (data.compare.fromtexthidden !== undefined) {\n        $diffArea\n          .find('.diff-otitle .diff-version')\n          .addClass('diff-hidden-history')\n      }\n      if (data.compare.totexthidden !== undefined) {\n        $diffArea\n          .find('.diff-ntitle .diff-version')\n          .addClass('diff-hidden-history')\n      }\n      if (data.compare.fromuserhidden !== undefined) {\n        $diffArea\n          .find('.diff-otitle .diff-user')\n          .addClass('diff-hidden-history')\n      }\n      if (data.compare.touserhidden !== undefined) {\n        $diffArea\n          .find('.diff-ntitle .diff-user')\n          .addClass('diff-hidden-history')\n      }\n      if (data.compare.fromcommenthidden !== undefined) {\n        $diffArea.find('.diff-comment').addClass('diff-hidden-history')\n      }\n      if (data.compare.tocommenthidden !== undefined) {\n        $diffArea\n          .find('.diff-ntitle .diff-comment')\n          .addClass('diff-hidden-history')\n      }\n      if (data.error) {\n        console.warn('[InPageEdit] 快速差异获取时系统告知出现问题')\n        $diffArea.html(\n          _msg('diff-error') +\n            ': ' +\n            data.error.info +\n            '(<code>' +\n            data.error.code +\n            '</code>)'\n        )\n      }\n    })\n    .fail(function (errorCode, errorThrown) {\n      console.warn('[InPageEdit] 快速差异获取失败')\n      $loading.hide()\n      if (\n        errorThrown.error &&\n        errorThrown.error.info &&\n        errorThrown.error.code\n      ) {\n        $diffArea\n          .show()\n          .html(\n            _msg('diff-error') +\n              ': ' +\n              errorThrown.error.info +\n              '(<code>' +\n              errorThrown.error.code +\n              '</code>)'\n          )\n      } else {\n        $diffArea.show().html(_msg('diff-error'))\n      }\n    })\n}\n\nmodule.exports = {\n  quickDiff,\n}\n","var mwApi = new mw.Api()\nvar config = mw.config.get()\n\nconst { _analysis } = require('./_analysis')\nconst { _msg } = require('./_msg')\nconst { _hasRight } = require('./_hasRight')\n\nconst { $br, $progress } = require('./_elements')\n\nconst { findAndReplace } = require('./findAndReplace')\nconst { preference } = require('./preference')\nconst { progress } = require('./progress')\nconst { quickPreview } = require('./quickPreview')\nconst { quickDiff } = require('./quickDiff')\n\n/**\n * @module quickEdit 快速编辑模块\n *\n * @param {Object} options\n * @param {String} options.page edit page (default: wgPageName)\n * @param {Number} options.revision page rev ID\n * @param {Number} options.section edit section\n * @param {Boolean} options.reload if reload page after save successful (default: true)\n */\nvar quickEdit = function (options) {\n  /** 获取设定信息，设置缺省值 **/\n  options = options || {}\n  if (typeof options === 'string') {\n    options = {\n      page: options || config.wgPageName,\n    }\n  }\n  var defaultOptions = {\n    page: config.wgPageName,\n    pageId: -1,\n    revision: null,\n    summaryRevision: '',\n    section: null,\n    editText: '',\n    editMinor: false,\n    editSummary: _msg('preference-summary-default'),\n    editNotice: '',\n    outSideClose: true,\n    jsonGet: {\n      action: 'parse',\n      page: options.page || config.wgPageName,\n      prop: 'wikitext|langlinks|categories|templates|images|sections',\n      format: 'json',\n    },\n    jsonPost: {},\n    pageDetail: {},\n    jumpTo: '',\n    reload: true,\n  }\n\n  /** 获取用户设置 **/\n  var userPreference = preference.get()\n\n  /** 缓存时间戳 **/\n  var date = new Date(),\n    timestamp = date.getTime(),\n    now = date.toUTCString()\n\n  /** 将选项合并并标准化 **/\n  options = $.extend({}, defaultOptions, options, userPreference)\n  options.page = decodeURI(options.page) // 解码网址 Unicode\n\n  _analysis('quick_edit')\n\n  if (options.revision && options.revision !== config.wgCurRevisionId) {\n    ssi_modal.notify('warning', {\n      className: 'in-page-edit',\n      content: _msg('notify-editing-history'),\n      title: _msg('notify-info'),\n    })\n    delete options.jsonGet.page\n    options.jsonGet.oldid = options.revision\n    options.summaryRevision =\n      '(' +\n      _msg('editor-summary-rivision') +\n      '[[Special:Diff/' +\n      options.revision +\n      ']])'\n  }\n  if (options.section) {\n    options.jsonGet.section = options.section\n  }\n\n  // 模态框内部\n  var $modalTitle = $('<span>').append(\n    _msg('editor-title-editing') +\n      ': <u class=\"editPage\">' +\n      options.page.replace(/_/g, ' ') +\n      '</u>'\n  )\n  var $editTools = $('<div>', { class: 'editTools' }).append(\n    $('<div>', { class: 'btnGroup' }).append(\n      $('<div>', { class: 'toolSelect' }).append(\n        $('<div>', { class: 'label', text: _msg('editor-edittool-header') }),\n        $('<ul>', { class: 'ul-list' }).append(\n          $('<li>', {\n            class: 'editToolBtn',\n            'data-open': '\\n== ',\n            'data-middle': _msg('editor-edittool-header-text'),\n            'data-close': ' ==\\n',\n            text: 'H2',\n          }),\n          $('<li>', {\n            class: 'editToolBtn',\n            'data-open': '\\n=== ',\n            'data-middle': _msg('editor-edittool-header-text'),\n            'data-close': ' ===\\n',\n            text: 'H3',\n          }),\n          $('<li>', {\n            class: 'editToolBtn',\n            'data-open': '\\n==== ',\n            'data-middle': _msg('editor-edittool-header-text'),\n            'data-close': ' ====\\n',\n            text: 'H4',\n          }),\n          $('<li>', {\n            class: 'editToolBtn',\n            'data-open': '\\n===== ',\n            'data-middle': _msg('editor-edittool-header-text'),\n            'data-close': ' =====\\n',\n            text: 'H5',\n          })\n        )\n      )\n    ),\n    $('<div>', { class: 'btnGroup' }).append(\n      $('<span>', { class: 'label', text: '格式' }),\n      $('<button>', {\n        class: 'editToolBtn fa fa-bold btn',\n        'data-open': \"'''\",\n        'data-middle': _msg('editor-edittool-bold'),\n        'data-close': \"'''\",\n      }),\n      $('<button>', {\n        class: 'editToolBtn fa fa-italic btn',\n        'data-open': \"''\",\n        'data-middle': _msg('editor-edittool-italic'),\n        'data-close': \"''\",\n      }),\n      $('<button>', {\n        class: 'editToolBtn fa fa-list-ul btn',\n        'data-open': '\\n* ',\n        'data-middle': _msg('editor-edittool-list-bulleted'),\n        'data-close': '\\n',\n      }),\n      $('<button>', {\n        class: 'editToolBtn fa fa-list-ol btn',\n        'data-open': '\\n# ',\n        'data-middle': _msg('editor-edittool-list-numbered'),\n        'data-close': '\\n',\n      }),\n      $('<button>', {\n        class: 'editToolBtn fa fa-won btn',\n        'data-open': '<' + 'nowiki>',\n        'data-middle': _msg('editor-edittool-nowiki'),\n        'data-close': '</nowiki>',\n      }),\n      $('<button>', {\n        class: 'editToolBtn fa fa-level-down fa-rotate-90 btn',\n        'data-open': '<br>\\n',\n        'data-middle': '',\n        'data-close': '',\n      })\n    ),\n    $('<div>', { class: 'btnGroup' }).append(\n      $('<span>', { class: 'label', text: '插入' }),\n      $('<button>', {\n        class: 'editToolBtn fa fa-link btn',\n        'data-open': '[' + '[',\n        'data-middle': _msg('editor-edittool-internal-link'),\n        'data-close': ']]',\n      }),\n      $('<button>', {\n        class: 'editToolBtn fa fa-file-image-o btn',\n        'data-open': '[' + '[File:',\n        'data-middle': 'Example.png',\n        'data-close': '|thumb]]',\n      }),\n      $('<button>', {\n        class: 'editToolBtn btn',\n        'data-open': '\\n<' + 'gallery>\\n',\n        'data-middle': 'Example1.jpg|Description\\nExample2.png|Description',\n        'data-close': '\\n</gallery>\\n',\n        html:\n          '<span class=\"fa-stack\"><i class=\"fa fa-picture-o fa-stack-1x\"></i><i class=\"fa fa-picture-o fa-stack-1x\" style=\"left: 2px;top: 2px;text-shadow: 1px 1px 0 #fff;\"></i></span>',\n      })\n    ),\n    $('<div>', { class: 'btnGroup extra', style: 'display: none' }).append(\n      $('<span>', { class: 'label', text: '自定义' })\n    ),\n    $('<div>', {\n      class: 'btnGroup special-tools',\n      style: 'float: right',\n    }).append(\n      $('<button>', { class: 'btn fa fa-search' }).click(function () {\n        findAndReplace($editArea)\n      })\n    )\n  )\n  var $editArea = $('<textarea>', {\n    class: 'editArea',\n    style: 'margin-top: 0;',\n  })\n  var $optionsLabel = $('<div>', {\n    class: 'editOptionsLabel hideBeforeLoaded',\n  }).append(\n    $('<aside>', { class: 'detailArea' }).append(\n      $('<label>', {\n        class: 'detailToggle',\n        text: _msg('editor-detail-button-toggle'),\n      }),\n      $('<div>', { class: 'detailBtnGroup' }).append(\n        $('<a>', {\n          href: 'javascript:;',\n          class: 'detailBtn',\n          id: 'showTemplates',\n          text: _msg('editor-detail-button-templates'),\n        }),\n        ' | ',\n        $('<a>', {\n          href: 'javascript:;',\n          class: 'detailBtn',\n          id: 'showImages',\n          text: _msg('editor-detail-button-images'),\n        })\n      )\n    ),\n    // 摘要&小编辑\n    $('<label>', { for: 'editSummary', text: _msg('editSummary') }),\n    $br,\n    $('<input>', {\n      class: 'editSummary',\n      id: 'editSummary',\n      placeholder: 'Edit via InPageEdit~',\n      value: options.editSummary.replace(/\\$oldid/gi, options.summaryRevision),\n    }),\n    $br,\n    $('<label>').append(\n      $('<input>', {\n        type: 'checkbox',\n        class: 'editMinor',\n        id: 'editMinor',\n        checked: options.editMinor,\n      }),\n      $('<span>', { text: _msg('markAsMinor') })\n    ),\n    $br,\n    $('<label>').append(\n      $('<input>', {\n        type: 'checkbox',\n        class: 'reloadPage',\n        id: 'reloadPage',\n        checked: options.reload,\n      }),\n      $('<span>', { text: _msg('editor-reload-page') })\n    )\n  )\n  var $modalContent = $('<div>').append(\n    $progress,\n    $('<section>', { class: 'hideBeforeLoaded' }).append(\n      // 编辑工具条\n      $editTools,\n      // 编辑框\n      $editArea\n    )\n  )\n\n  // Debug\n  console.time('[InPageEdit] 获取页面源代码')\n  console.info('[InPageEdit] QuickEdit start with options:')\n  console.table(options)\n\n  // 显示主窗口\n  ssi_modal.show({\n    title: $modalTitle,\n    content: $modalContent,\n    outSideClose: options.outSideClose,\n    className: 'in-page-edit ipe-editor timestamp-' + timestamp,\n    sizeClass: 'large',\n\n    /* 按钮 */\n    buttons: [\n      {\n        side: 'left',\n        label: _msg('editor-button-save'),\n        className: 'btn btn-primary leftBtn hideBeforeLoaded save-btn',\n        method(e, modal) {\n          ssi_modal.confirm(\n            {\n              className: 'in-page-edit',\n              center: true,\n              content: _msg('editor-confirm-save'),\n              okBtn: {\n                className: 'btn btn-primary',\n                label: _msg('confirm'),\n              },\n              cancelBtn: {\n                className: 'btn btn-secondary',\n                label: _msg('cancel'),\n              },\n            },\n            function (result) {\n              if (result) {\n                var text = $editArea.val(),\n                  minor = $optionsLabel.find('.editMinor').prop('checked'),\n                  section = options.section,\n                  summary = $optionsLabel.find('.editSummary').val()\n                postArticle(\n                  {\n                    text: text,\n                    page: options.page,\n                    minor: minor,\n                    section: section,\n                    summary: summary,\n                  },\n                  modal\n                )\n              }\n            }\n          )\n        },\n      },\n      {\n        side: 'left',\n        label: _msg('editor-button-preview'),\n        className: 'btn btn-secondary leftBtn hideBeforeLoaded',\n        method() {\n          _analysis('preview_edit')\n          var text = $editArea.val()\n          quickPreview({\n            title: options.page,\n            text: text,\n            pst: true,\n          })\n        },\n      },\n      {\n        side: 'left',\n        label: _msg('editor-button-diff'),\n        className: 'btn btn-secondary leftBtn hideBeforeLoaded diff-btn',\n      },\n      {\n        label: _msg('cancel'),\n        className: 'btn btn-danger',\n        method(e, modal) {\n          modal.close()\n        },\n      },\n    ],\n\n    /* 预加载 */\n    beforeShow($modal) {\n      var $modalWindow = $('#' + $modal.modalId)\n      // 设置样式\n      $modalWindow.find('.hideBeforeLoaded').hide()\n      $modalContent\n        .find('.ipe-progress')\n        .css('margin', Number($(window).height() / 3 - 50) + 'px 0')\n      $editArea.css('height', ($(window).height() / 3) * 2 - 100)\n      $modalWindow.find('.ssi-buttons').prepend($optionsLabel)\n      $modalWindow.find('.ssi-modalTitle').append(\n        $('<a>', {\n          class: 'showEditNotice',\n          href: 'javascript:void(0);',\n          html:\n            '<i class=\"fa fa-info-circle\"></i> ' +\n            _msg('editor-has-editNotice'),\n          style: 'display: none;',\n        }).click(function () {\n          ssi_modal.show({\n            className: 'in-page-edit',\n            center: true,\n            title: _msg('editor-title-editNotice'),\n            content:\n              '<section class=\"editNotice\">' +\n              $modalContent.data('editNotice') +\n              '</section>',\n          })\n        })\n      )\n\n      /** Edit-Tool 扩展 **/\n      function insertText(strings, obj) {\n        var textarea = obj || $editArea[0],\n          start = textarea.selectionStart,\n          stop = textarea.selectionEnd,\n          selectedText = textarea.value.slice(start, stop)\n        textarea.value =\n          textarea.value.slice(0, start) +\n          (strings.open || '') +\n          (selectedText || strings.middle || '') +\n          (strings.close || '') +\n          textarea.value.slice(stop)\n        var selectStart = start + (strings.open.length || 0)\n        textarea.setSelectionRange(\n          selectStart,\n          selectStart + (selectedText.length || strings.middle.length || 0)\n        )\n        textarea.focus()\n      }\n      // 添加按钮\n      function addBtn(open, middle, close, icon) {\n        open = open || ''\n        middle = middle || ''\n        close = close || ''\n        icon = 'fa-' + icon || 'fa-wrench'\n        $modalContent.find('.btnGroup.extra').append(\n          $('<button>', {\n            class: 'editToolBtn btn',\n            'data-open': open,\n            'data-middle': middle,\n            'data-close': close,\n            html: `<i class=\"fa ${icon}\"></i>`,\n          })\n        )\n      }\n      // 用户自定义按钮\n      if (InPageEdit.buttons) {\n        var btns = InPageEdit.buttons\n        $editTools.find('.btnGroup.extra').show()\n\n        for (var i = 0; i < btns.length; i++) {\n          var btn = btns[i]\n          addBtn(btn.open, btn.middle, btn.close, btn.text)\n        }\n      }\n      $editTools.find('.editToolBtn').click(function (e) {\n        e.preventDefault()\n        var $this = $(this),\n          $open = $this.attr('data-open') || '',\n          $middle = $this.attr('data-middle') || '',\n          $close = $this.attr('data-close') || ''\n        insertText(\n          {\n            open: $open,\n            middle: $middle,\n            close: $close,\n          },\n          $editArea[0]\n        )\n      })\n    },\n    /**\n     * @event onShow\n     * @description 模态框显示后\n     */\n    onShow($modal) {\n      var $modalWindow = $('#' + $modal.modalId)\n      mw.hook('InPageEdit.quickEdit').fire({\n        $modal,\n        $modalWindow,\n        $modalTitle,\n        $modalContent,\n        $editArea,\n        $editTools,\n        $optionsLabel,\n      })\n      // 绑定事件，在尝试离开页面时提示\n      $editArea.change(function () {\n        $(this).attr('data-modifiled', 'true')\n        $(window).bind('beforeunload', function () {\n          return _msg('window-leave-confirm')\n        })\n      })\n      // 获取权限\n      if (!_hasRight('edit')) {\n        ssi_modal.notify('dialog', {\n          className: 'in-page-edit',\n          position: 'center bottom',\n          title: _msg('notify-no-right'),\n          content: _msg('editor-no-right'),\n          okBtn: {\n            label: _msg('ok'),\n            className: 'btn btn-primary',\n            method(e, modal) {\n              modal.close()\n            },\n          },\n        })\n        $modalWindow.find('.save-btn').addClass('btn-danger')\n      }\n\n      // 解析页面内容\n      mwApi\n        .get(options.jsonGet)\n        .done(function (data) {\n          console.timeEnd('[InPageEdit] 获取页面源代码')\n          contentDone(data)\n        })\n        .fail(function (a, b, errorThrown) {\n          console.timeEnd('[InPageEdit] 获取页面源代码')\n          console.warn('[InPageEdit]警告：无法获取页面内容')\n          var data = errorThrown\n          contentDone(data)\n        })\n\n      // 页面内容获取完毕，后续工作\n      function contentDone(data) {\n        options.pageDetail = data\n\n        if (data.error) {\n          console.warn('[InPageEdit]警告：无法获取页面内容')\n          options.editText = '<!-- ' + data.error.info + ' -->'\n          options.pageId = -1\n          $optionsLabel.find('.detailArea').hide()\n        } else {\n          options.editText = data.parse.wikitext['*']\n          options.pageId = data.parse.pageid\n        }\n        // 设定一堆子样式\n        $modalContent.find('.ipe-progress').hide()\n        $modalWindow.find('.hideBeforeLoaded').fadeIn(500)\n        $editArea.val(options.editText + '\\n')\n\n        var summaryVal\n        if (options.section !== null) {\n          summaryVal = $optionsLabel.find('.editSummary').val()\n          summaryVal = summaryVal.replace(\n            /\\$section/gi,\n            '/* ' + data.parse.sections[0].line + ' */'\n          )\n          $optionsLabel.find('.editSummary').val(summaryVal)\n          $modalTitle\n            .find('.editPage')\n            .after(\n              '<span class=\"editSection\">→' +\n                data.parse.sections[0].line +\n                '</span>'\n            )\n          options.jumpTo = '#' + data.parse.sections[0].anchor\n        } else {\n          summaryVal = $optionsLabel.find('.editSummary').val()\n          summaryVal = summaryVal.replace(/\\$section/gi, '')\n          $optionsLabel.find('.editSummary').val(summaryVal)\n          options.jumpTo = ''\n        }\n        if (\n          options.revision !== null &&\n          options.revision !== '' &&\n          options.revision !== config.wgCurRevisionId\n        ) {\n          $modalTitle\n            .find('.editPage')\n            .after(\n              '<span class=\"editRevision\">(' +\n                _msg('editor-title-editRevision') +\n                '：' +\n                options.revision +\n                ')</span>'\n            )\n          $modalWindow.find('.diff-btn').click(function () {\n            _analysis('quick_diff_edit')\n            var text = $editArea.val()\n            var diffJson = {\n              fromrev: options.revision,\n              totext: text,\n              hideBtn: true,\n              pageName: options.page,\n              isPreview: true,\n            }\n            if (options.section) {\n              diffJson.fromsection = options.section\n            }\n            quickDiff(diffJson)\n          })\n        } else {\n          $modalWindow.find('.diff-btn').attr('disabled', true)\n        }\n\n        // 获取页面基础信息\n        console.time('[InPageEdit] 获取页面基础信息')\n        var queryJson = {\n          action: 'query',\n          prop: 'revisions|info',\n          inprop: 'protection',\n          format: 'json',\n        }\n        if (options.pageId !== -1) {\n          queryJson.pageids = options.pageId\n        } else {\n          queryJson.titles = options.page\n        }\n        mwApi\n          .get(queryJson)\n          .done(function (data) {\n            console.info('[InPageEdit] 获取页面基础信息成功')\n            console.timeEnd('[InPageEdit] 获取页面基础信息')\n            // 记录页面最后编辑时间，防止编辑冲突\n            $modalContent.data(\n              'basetimestamp',\n              data['query']['pages'][options.pageId].revisions\n                ? data['query']['pages'][options.pageId]['revisions'][0][\n                    'timestamp'\n                  ]\n                : now\n            )\n            queryDone(data)\n          })\n          .fail(function (a, b, errorThrown) {\n            var data = errorThrown\n            console.timeEnd('[InPageEdit] 获取页面基础信息')\n            console.warn('[InPageEdit] 获取页面基础信息失败')\n            $modalContent.data('basetimestamp', now)\n            queryDone(data)\n          })\n\n        /** 页面保护等级和编辑提示等 **/\n        function queryDone(data) {\n          options.namespace = data.query.pages[options.pageId].ns // 名字空间ID\n          options.protection =\n            data.query.pages[options.pageId]['protection'] || [] // 保护等级\n          if (data.query.pages[options.pageId].revisions) {\n            options.revision =\n              data.query.pages[options.pageId]['revisions'][0]['revid'] // 版本号\n          }\n\n          // 使页面名标准化\n          options.page = data.query.pages[options.pageId].title\n          $modalTitle.find('.editPage').text(options.page)\n\n          if (options.revision) {\n            $modalWindow\n              .find('.diff-btn')\n              .attr('disabled', false)\n              .click(function () {\n                _analysis('quick_diff_edit')\n                var text = $editArea.val()\n                var diffJson = {\n                  fromrev: options.revision,\n                  totext: text,\n                  hideBtn: true,\n                  pageName: options.page,\n                  isPreview: true,\n                }\n                if (options.section) {\n                  diffJson.fromsection = options.section\n                }\n                quickDiff(diffJson)\n              })\n          }\n\n          // 页面是否被保护\n          if (options.protection.length > 0) {\n            for (var i = 0; i < options.protection.length; i++) {\n              if (options.protection[i].type === 'edit') {\n                if (\n                  (options.protection[i].level === 'autoconfirmed' &&\n                    !_hasRight('autoconfirmed')) ||\n                  (options.protection[i].level === 'sysop' &&\n                    !_hasRight('editprotected')) ||\n                  (config.wgNamespaceNumber === 8 &&\n                    !_hasRight('editinterface'))\n                ) {\n                  ssi_modal.notify('dialog', {\n                    className: 'in-page-edit',\n                    position: 'center bottom',\n                    title: _msg('notify-no-right'),\n                    content: _msg('editor-no-right'),\n                    okBtn: {\n                      label: _msg('ok'),\n                      className: 'btn btn-primary',\n                      method(e, modal) {\n                        modal.close()\n                      },\n                    },\n                  })\n                  $modalWindow.find('.save-btn').addClass('btn-danger')\n                }\n              }\n            }\n          }\n\n          // 获取编辑提示\n          var namespaceNoticePage = 'Editnotice-' + options.namespace,\n            pageNoticePage =\n              namespaceNoticePage +\n              '-' +\n              options.page\n                .replace(/_/g, ' ') // 将页面名里的 _ 转换为空格\n                .replace(\n                  config.wgFormattedNamespaces[options.namespace] + ':',\n                  ''\n                ) // 去掉名字空间\n\n          mwApi\n            .get({\n              action: 'query',\n              meta: 'allmessages',\n              ammessages: namespaceNoticePage + '|' + pageNoticePage,\n            })\n            .done(function (data) {\n              var wikitextNs = data.query.allmessages[0]['*'] || '',\n                wikitextPage = data.query.allmessages[1]['*'] || ''\n              if (wikitextNs === '' && wikitextPage === '') return // 没有编辑提示\n              // 将编辑提示解析为 html\n              mwApi\n                .post({\n                  action: 'parse',\n                  title: options.page,\n                  contentmodel: 'wikitext',\n                  preview: true,\n                  text: wikitextPage + '\\n' + wikitextNs,\n                })\n                .done(function (data) {\n                  options.editNotice = data.parse.text['*']\n                  var notice = $modalContent.data('editNotice') || ''\n                  notice += '\\n' + options.editNotice\n                  $modalContent.data('editNotice', notice)\n                  $modalContent.find('.showEditNotice').show()\n                })\n            })\n        }\n      }\n    },\n\n    /* 确认是否取消 */\n    beforeClose(modal) {\n      if ($editArea.attr('data-modifiled') !== 'true') {\n        close()\n        return\n      } else if ($editArea.attr('data-confirmclose') === 'true') {\n        closeNoReload()\n        return\n      }\n      ssi_modal.confirm(\n        {\n          className: 'in-page-edit',\n          center: true,\n          content: _msg('editor-leave-confirm'),\n          okBtn: {\n            className: 'btn btn-danger',\n            label: _msg('confirm'),\n          },\n          cancelBtn: {\n            className: 'btn btn-secondary',\n            label: _msg('cancel'),\n          },\n        },\n        function (result) {\n          if (result === true) {\n            close()\n          }\n        }\n      )\n      function close() {\n        $(window).unbind('beforeunload')\n        modal.options.keepContent = false\n        modal.options.beforeClose = ''\n        modal.close()\n        ssi_modal.notify('info', {\n          className: 'in-page-edit',\n          position: 'right top',\n          title: _msg('cancel'),\n          content: _msg('notify-no-change'),\n        })\n      }\n      function closeNoReload() {\n        $(window).unbind('beforeunload')\n        modal.options.keepContent = false\n        modal.options.beforeClose = ''\n        modal.close()\n      }\n      return false\n    },\n  })\n\n  // 页面详情模块\n  $optionsLabel.find('.detailBtnGroup .detailBtn').click(function () {\n    _analysis('quick_edit_pagedetail')\n    var $this = $(this),\n      id = $this.attr('id'),\n      content = $('<ul>')\n    switch (id) {\n      case 'showTemplates':\n        var templates = options.pageDetail.parse.templates,\n          templateName\n        for (let i = 0; i < templates.length; i++) {\n          templateName = templates[i]['*']\n          $('<li>')\n            .append(\n              $('<a>', {\n                href: mw.util.getUrl(templateName),\n                target: '_blank',\n                text: templateName,\n              }),\n              ' (',\n              $('<a>', {\n                href: 'javascript:;',\n                text: _msg('quick-edit'),\n                class: 'quickEditTemplate',\n                'data-template-name': templateName,\n              }),\n              ')'\n            )\n            .appendTo(content)\n        }\n        ssi_modal.show({\n          className: 'in-page-edit quick-edit-detail',\n          sizeClass: 'dialog',\n          title: _msg('editor-detail-title-templates'),\n          content: content,\n        })\n        break\n      case 'showImages':\n        var images = options.pageDetail.parse.images,\n          imageName\n        for (let i = 0; i < images.length; i++) {\n          imageName = images[i]\n          $('<li>')\n            .append(\n              $('<a>', {\n                href: mw.util.getUrl('File:' + imageName),\n                target: '_balnk',\n                text: imageName,\n              }),\n              ' (',\n              $('<a>', {\n                href: 'javascript:;',\n                class: 'quickViewImage',\n                text: _msg('editor-detail-images-quickview'),\n                'data-image-name': imageName,\n              }),\n              ' | ',\n              $('<a>', {\n                href:\n                  config.wgScript +\n                  '?title=Special:Upload&wpDestFile=' +\n                  imageName +\n                  '&wpForReUpload=1',\n                target: '_balnk',\n                text: _msg('editor-detail-images-upload'),\n              }),\n              ')'\n            )\n            .appendTo(content)\n        }\n        ssi_modal.show({\n          className: 'in-page-edit quick-edit-detail',\n          sizeClass: 'dialog',\n          title: _msg('editor-detail-title-images'),\n          content,\n        })\n        break\n    }\n    $('.in-page-edit.quick-edit-detail .quickEditTemplate').click(function () {\n      _analysis('quick_edit_pagedetail_edit_template')\n      var $this = $(this)\n      var page = $this.attr('data-template-name')\n      quickEdit({\n        page,\n      })\n    })\n    $('.in-page-edit.quick-edit-detail .quickViewImage').click(function () {\n      _analysis('quick_edit_pagedetail_view_image')\n      var $this = $(this)\n      var imageName = $this.attr('data-image-name')\n      ssi_modal.show({\n        className: 'in-page-edit quick-view-image',\n        center: true,\n        title: imageName.replace(/_/g, ' '),\n        content: $('<center>', { id: 'imageLayer' }).append($progress),\n        buttons: [\n          {\n            label: _msg('editor-detail-images-upload'),\n            className: 'btn btn-primary',\n            method() {\n              window.open(\n                config.wgScript +\n                  '?title=Special:Upload&wpDestFile=' +\n                  imageName +\n                  '&wpForReUpload=1'\n              )\n            },\n          },\n          {\n            label: _msg('close'),\n            className: 'btn btn-secondary',\n            method(a, modal) {\n              modal.close()\n            },\n          },\n        ],\n        onShow() {\n          mwApi\n            .get({\n              action: 'query',\n              format: 'json',\n              prop: 'imageinfo',\n              titles: 'File:' + imageName.replace(/file:/g, ''),\n              iiprop: 'url',\n            })\n            .done(function (data) {\n              $('.quick-view-image .ipe-progress').hide()\n              $('.quick-view-image #imageLayer').append(\n                $('<img>', {\n                  src: data.query.pages['-1'].imageinfo[0].url,\n                  class: 'loading',\n                  style: 'max-width: 80%; max-height: 60vh',\n                })\n              )\n              $('.quick-view-image #imageLayer img').load(function () {\n                $(this).removeClass('loading')\n              })\n            })\n        },\n      })\n    })\n  })\n\n  // 发布编辑模块\n  function postArticle({ text, page, minor, summary, section }, modal) {\n    _analysis('quick_edit_save')\n    progress(_msg('editor-title-saving'))\n    options.jsonPost = {\n      action: 'edit',\n      basetimestamp: $modalContent.data('basetimestamp'),\n      starttimestamp: now,\n      text,\n      title: page,\n      minor,\n      summary,\n      errorformat: 'plaintext',\n    }\n    if (section !== undefined && section !== '' && section !== null) {\n      options.jsonPost.section = section\n      delete options.jsonPost.basetimestamp\n    }\n\n    mwApi\n      .postWithToken('csrf', options.jsonPost)\n      .done(saveSuccess)\n      .fail(saveError)\n\n    // 保存正常\n    function saveSuccess(data, feedback, errorThrown) {\n      if (data.edit.result === 'Success') {\n        progress(true)\n        // 是否重载页面\n        if ($optionsLabel.find('.reloadPage').prop('checked')) {\n          var content\n          $(window).unbind('beforeunload')\n          content = _msg('notify-save-success')\n          setTimeout(function () {\n            if (page === config.wgPageName) {\n              window.location = mw.util.getUrl(page) + options.jumpTo\n              window.location.reload()\n            } else {\n              window.location.reload()\n            }\n          }, 500)\n        } else {\n          console.info('[InPageEdit] 将不会重载页面！')\n          content = _msg('notify-save-success-noreload')\n          setTimeout(function () {\n            progress(false)\n            $editArea.attr('data-confirmclose', 'true')\n            modal.close()\n          }, 1500)\n        }\n\n        ssi_modal.notify('success', {\n          className: 'in-page-edit',\n          position: 'right top',\n          title: _msg('notify-success'),\n          content,\n        })\n      } else {\n        saveError(data, feedback, errorThrown)\n      }\n    }\n\n    // 保存失败\n    function saveError(errorCode, feedback, errorThrown) {\n      progress(false)\n      var data = errorThrown || errorCode // 规范错误代码\n      var errorInfo,\n        errorMore = ''\n      if (data.errors !== undefined) {\n        errorCode = data.errors[0].code\n        errorInfo = data.errors[0]['*']\n        errorMore = ''\n      } else if (data.edit.result !== 'Success') {\n        errorCode = data.edit.code || 'Unknown'\n        errorInfo = data.edit.info || 'Reason unknown.'\n        errorMore = data.edit.warning || ''\n      } else {\n        errorCode = 'unknown'\n        errorInfo = 'Reason unknown.'\n        errorMore = 'Please contact plug-in author or try again.'\n      }\n      ssi_modal.show({\n        className: 'in-page-edit',\n        sizeClass: 'dialog',\n        center: true,\n        title: _msg('editor-save-error'),\n        content: errorInfo + '<hr style=\"clear: both\" />' + errorMore,\n      })\n      ssi_modal.notify('error', {\n        className: 'in-page-edit',\n        position: 'right top',\n        closeAfter: {\n          time: 15,\n        },\n        title: _msg('notify-error'),\n        content: _msg('editor-save-error') + '：<code>' + errorCode + '</code>',\n      })\n\n      console.error('[InPageEdit] Submit failed: \\nCode: ' + errorCode)\n      return\n    }\n  }\n}\n\nmodule.exports = {\n  quickEdit,\n}\n","const { _msg } = require('./_msg')\nconst { $progress } = require('./_elements')\n\nvar mwApi = new mw.Api()\n\n/**\n * @module quickPreview 快速预览文章页\n * @param params {Object}\n */\nvar quickPreview = function (params, modalSize = 'large', center = false) {\n  var defaultOptions = {\n    action: 'parse',\n    preview: true,\n    disableeditsection: true,\n    prop: 'text',\n    format: 'json',\n  }\n  var options = $.extend({}, defaultOptions, params)\n  mw.hook('InPageEdit.quickPreview').fire()\n  var timestamp = new Date().getTime()\n  console.time('[InPageEdit] Request preview')\n  ssi_modal.show({\n    sizeClass: new RegExp(\n      /dialog|small|smallToMedium|medium|mediumToLarge|large|full|auto/\n    ).test(modalSize)\n      ? modalSize\n      : 'large',\n    center: Boolean(center),\n    className: 'in-page-edit previewbox',\n    title: _msg('preview-title'),\n    content: $('<section>').append(\n      $progress,\n      $('<div>', {\n        class: 'InPageEditPreview',\n        'data-timestamp': timestamp,\n        style: 'display:none',\n        text: _msg('preview-placeholder'),\n      })\n    ),\n    fixedHeight: true,\n    fitScreen: true,\n    buttons: [{ label: '', className: 'hideThisBtn' }],\n    onShow() {\n      $('.previewbox .ipe-progress').css(\n        'margin-top',\n        $('.previewbox .ipe-progress').parent().height() / 2\n      )\n      $('.previewbox .hideThisBtn').hide()\n      mwApi\n        .post(options)\n        .then(function (data) {\n          console.timeEnd('[InPageEdit] Request preview')\n          var content = data.parse.text['*']\n          $('.previewbox .ipe-progress').hide(150)\n          $('.InPageEditPreview[data-timestamp=\"' + timestamp + '\"]')\n            .fadeIn(500)\n            .html(content)\n        })\n        .fail(function () {\n          console.timeEnd('[InPageEdit] Request preview')\n          console.warn('[InPageEdit] 预览失败')\n          $('.previewbox .ipe-progress').hide(150)\n          $('.InPageEditPreview[data-timestamp=\"' + timestamp + '\"]')\n            .fadeIn(500)\n            .html(_msg('preview-error'))\n        })\n    },\n  })\n}\n\nmodule.exports = {\n  quickPreview,\n}\n","var mwApi = new mw.Api()\nvar config = mw.config.get()\n\nconst { _analysis } = require('./_analysis')\nconst { _msg } = require('./_msg')\nconst { $br, $progress } = require('./_elements')\n\nconst { _resolveExists } = require('./_resolveExists')\nconst { preference } = require('./preference')\n\n/**\n * @module quickRedirect 快速重定向模块\n * @param {'from'|'to'} type\n */\nvar quickRedirect = function (type = 'to') {\n  mw.hook('InPageEdit.quickRedirect').fire()\n  var text = '#REDIRECT [[:$1]]',\n    question,\n    target,\n    json = {\n      action: 'edit',\n      createonly: 1,\n      minor: preference.get('editMinor'),\n      format: 'json',\n      errorformat: 'plaintext',\n    },\n    summary\n\n  if (type === 'to') {\n    json.title = config.wgPageName\n    question = _msg(\n      'redirect-question-to',\n      '<b>' + config.wgPageName.replace(/_/g, ' ') + '</b>'\n    )\n  } else if (type === 'from') {\n    question = _msg(\n      'redirect-question-from',\n      '<b>' + config.wgPageName.replace(/_/g, ' ') + '</b>'\n    )\n    summary = _msg('redirect-summary') + ' → [[:' + config.wgPageName + ']]'\n    json.text = text.replace('$1', config.wgPageName)\n  } else {\n    console.error('[InPageEdit] quickRedirect only accept \"from\" or \"to\"')\n    return\n  }\n\n  ssi_modal.show({\n    outSideClose: false,\n    className: 'in-page-edit quick-redirect',\n    center: true,\n    sizeClass: 'dialog',\n    title: _msg('redirect-title'),\n    content: $('<div>').append(\n      $('<section>').append(\n        $('<span>', { html: question }),\n        $br,\n        $('<input>', { id: 'redirect-page', style: 'width:96%' }).click(\n          function () {\n            $(this).css('box-shadow', '')\n          }\n        ),\n        $br,\n        $('<label>', { for: 'redirect-reason', text: _msg('editSummary') }),\n        $('<input>', { id: 'redirect-reason', style: 'width:96%' })\n      ),\n      $($progress).css('display', 'none')\n    ),\n    buttons: [\n      {\n        label: _msg('confirm'),\n        className: 'btn btn-primary btn-single okBtn',\n        method: function (a, modal) {\n          target = $('.in-page-edit.quick-redirect #redirect-page').val()\n          if (\n            target === '' ||\n            target.replace(/_/g, ' ') === config.wgPageName.replace(/_/g, ' ')\n          ) {\n            $('.in-page-edit.quick-redirect #redirect-page').css(\n              'box-shadow',\n              '0 0 4px #f00'\n            )\n            return\n          }\n\n          _analysis('quick_redirect')\n\n          if (type === 'to') {\n            summary = _msg('redirect-summary') + ' → [[:' + target + ']]'\n            json.text = text.replace('$1', target)\n          } else if (type === 'from') {\n            json.title = target\n          }\n          if ($('.in-page-edit.quick-redirect #redirect-reason').val() !== '') {\n            summary =\n              summary +\n              ' (' +\n              $('.in-page-edit.quick-redirect #redirect-reason').val() +\n              ')'\n          }\n          json.summary = summary\n\n          $('.in-page-edit.quick-redirect .ipe-progress').show()\n          $('.in-page-edit.quick-redirect section').hide()\n          $('.in-page-edit.quick-redirect .okBtn').attr('disabled', 'disabled')\n\n          mwApi.postWithToken('csrf', json).done(successed).fail(failed)\n          // 重定向成功\n          function successed(data) {\n            if (data.errors) {\n              failed(data.errors[0].code, data)\n              return\n            }\n            $('.in-page-edit.quick-redirect .ipe-progress').addClass('done')\n            ssi_modal.notify('success', {\n              className: 'in-page-edit',\n              content: _msg('notify-redirect-success'),\n              title: _msg('notify-success'),\n            })\n            if (type === 'to') {\n              window.location.reload()\n            } else {\n              $('.in-page-edit.quick-redirect .ipe-progress').addClass('done')\n              setTimeout(function () {\n                modal.close()\n              }, 2000)\n            }\n          }\n          // 重定向失败\n          function failed(errorCode, errorThrown) {\n            $('.in-page-edit.quick-redirect .ipe-progress').hide()\n            $('.in-page-edit.quick-redirect section').show()\n            $('.in-page-edit.quick-redirect .okBtn').attr('disabled', false)\n            $('.in-page-edit.quick-redirect .ipe-progress').addClass('done')\n            ssi_modal.notify('error', {\n              className: 'in-page-edit',\n              content:\n                _msg('notify-redirect-error') +\n                '<br>' +\n                errorThrown.errors[0]['*'] +\n                ' (<code>' +\n                errorCode +\n                '</code>)',\n              title: _msg('notify-error'),\n            })\n            // 如果是由于页面存在，给出解决方案\n            if (errorCode === 'articleexists') {\n              var fromPage, toPage\n              if (type === 'from') {\n                fromPage = target\n                toPage = config.wgPageName\n              } else if (type === 'to') {\n                fromPage = config.wgPageName\n                toPage = target\n              }\n              _resolveExists(fromPage, {\n                delete: 'Delete for redirect to [[' + toPage + ']]',\n                edit: 'Modify for redirect',\n              })\n            }\n          }\n        },\n      },\n    ],\n  })\n}\n\nmodule.exports = {\n  quickRedirect,\n}\n","var mwApi = new mw.Api()\nvar config = mw.config.get()\n\nconst { _analysis } = require('./_analysis')\nconst { _msg } = require('./_msg')\nconst { _hasRight } = require('./_hasRight')\nconst { _resolveExists } = require('./_resolveExists')\nconst { $br } = require('./_elements')\n\nconst { progress } = require('./progress')\n\n/**\n * @module quickRename 快速重命名模块\n * @param {String} from\n * @param {String} to\n */\nvar quickRename = function (from, to) {\n  mw.hook('InPageEdit.quickRename').fire()\n  from = from || config.wgPageName\n  to = to || ''\n  var reason, movetalk, movesubpages, noredirect\n\n  ssi_modal.show({\n    outSideClose: false,\n    className: 'in-page-edit quick-rename',\n    center: true,\n    sizeClass: 'dialog',\n    title: _msg('rename-title'),\n    content: $('<section>').append(\n      $('<label>', {\n        for: 'move-to',\n        html: _msg('rename-moveTo', '<b>' + from.replace(/_/g, ' ') + '</b>'),\n      }),\n      $br,\n      $('<input>', {\n        id: 'move-to',\n        style: 'width:96%',\n        onclick: \"$(this).css('box-shadow','')\",\n      }),\n      $br,\n      $('<label>', { for: 'move-reason', text: _msg('editSummary') }),\n      $br,\n      $('<input>', { id: 'move-reason', style: 'width:96%' }),\n      $br,\n      $('<label>').append(\n        $('<input>', { type: 'checkbox', id: 'movetalk', checked: 'checked' }),\n        $('<span>', { text: _msg('rename-movetalk') })\n      ),\n      $br,\n      $('<label>').append(\n        $('<input>', {\n          type: 'checkbox',\n          id: 'movesubpages',\n          checked: 'checked',\n        }),\n        $('<span>', { text: _msg('rename-movesubpages') })\n      ),\n      $br,\n\n      $('<label>').append(\n        $('<input>', { type: 'checkbox', id: 'noredirect' }),\n        $('<span>', { text: _msg('rename-noredirect') })\n      )\n    ),\n    buttons: [\n      {\n        label: _msg('cancel'),\n        className: 'btn btn-secondary',\n        method: function (a, modal) {\n          modal.close()\n        },\n      },\n      {\n        label: _msg('confirm'),\n        className: 'btn btn-primary',\n        method: function () {\n          to = $('.in-page-edit.quick-rename #move-to').val()\n          if (\n            to === '' ||\n            to === config.wgPageName ||\n            to === config.wgPageName.replace(/_/g, ' ')\n          ) {\n            $('.in-page-edit.quick-rename #move-to').css(\n              'box-shadow',\n              '0 0 4px #f00'\n            )\n            return\n          }\n\n          _analysis('quick_move')\n\n          progress(_msg('editor-title-saving'))\n          movetalk = $('.in-page-edit.quick-rename #movetalk').prop('checked')\n          movesubpages = $('.in-page-edit.quick-rename #movesubpages').prop(\n            'checked'\n          )\n          noredirect = $('.in-page-edit.quick-rename #noredirect').prop(\n            'checked'\n          )\n          reason = $('.in-page-edit.quick-rename #move-reason').val()\n\n          if (reason === '') {\n            reason = _msg('rename-summary') + ' → [[:' + to + ']]'\n          } else {\n            reason =\n              _msg('rename-summary') + ' → [[:' + to + ']] (' + reason + ')'\n          }\n          mwApi\n            .postWithToken('csrf', {\n              action: 'move',\n              from: from,\n              to: to,\n              reason: reason,\n              movetalk: movetalk,\n              movesubpages: movesubpages,\n              noredirect: noredirect,\n            })\n            .done(function () {\n              progress(true)\n              ssi_modal.notify('success', {\n                className: 'in-page-edit',\n                content: _msg('notify-rename-success'),\n                title: _msg('notify-success'),\n              })\n              location.href = config.wgArticlePath.replace('$1', to)\n            })\n            .fail(function (errorCode, feedback, errorThrown) {\n              progress(false)\n              ssi_modal.notify('error', {\n                className: 'in-page-edit',\n                content:\n                  _msg('notify-rename-error') +\n                  ': ' +\n                  errorThrown.error.info +\n                  '<code>' +\n                  errorThrown.error.code +\n                  '</code>',\n                title: _msg('notify-error'),\n              })\n              // 如果原因是页面已存在，给出解决方案\n              if (errorThrown.error.code === 'articleexists') {\n                _resolveExists(to, 'For move page [[' + from + ']] to here.')\n              }\n            })\n        },\n      },\n    ],\n    beforeShow: function () {\n      if (!_hasRight('move')) {\n        ssi_modal.dialog({\n          title: _msg('notify-no-right'),\n          content: _msg('rename-no-right'),\n          className: 'in-page-edit quick-deletepage',\n          center: true,\n          okBtn: {\n            className: 'btn btn-primary btn-single',\n          },\n        })\n        return false\n      }\n    },\n  })\n}\n\nmodule.exports = {\n  quickRename,\n}\n","const api = require('./api.json')\nconst { _msg } = require('./_msg')\n\nfunction getNotice(cb) {\n  return $.get(api.specialNotice).then(data => {\n    cb && cb(data)\n  })\n}\n\nfunction getLocal() {\n  var noticeList = localStorage.getItem('InPageEditNoticeId') || []\n  try {\n    noticeList = JSON.parse(noticeList)\n  } catch (e) {\n    localStorage.setItem('InPageEditNoticeId', '[]')\n    noticeList = []\n  }\n  return noticeList\n}\n\nfunction setLocal({ id }) {\n  var noticeList = localStorage.getItem('InPageEditNoticeId') || []\n  try {\n    noticeList = JSON.parse(noticeList)\n  } catch (e) {\n    noticeList = []\n  }\n  if (!id.includes(noticeList)) {\n    noticeList.push(id)\n  }\n  localStorage.setItem('InPageEditNoticeId', JSON.stringify(noticeList))\n  console.info('[InPageEdit] Notice save as viewed', id)\n}\n\nfunction isViewed({ id }) {\n  var noticeList = getLocal()\n  var viewed = id.includes(noticeList)\n  console.info('[InPageEdit] Notice with id: ' + id, viewed)\n  return viewed\n}\n\nfunction makeList({ id, level, title, message }) {\n  return $('<section>', { class: 'notice-list level-' + level, id }).append(\n    $('<h4>', { html: title }),\n    $('<div>', { html: message })\n  )\n}\n\n/**\n * @module specialNotice 特别通知\n */\nvar specialNotice = function () {\n  getNotice(data => {\n    var noticeContainer = $('<div>', { class: 'ipe-notice-container' }),\n      noticeList = []\n    $.each(data, (_, item) => {\n      if (!isViewed(item)) {\n        noticeList.push(makeList(item))\n      }\n    })\n\n    console.info('[InPageEdit] Notice list', noticeList)\n\n    // 没有未读消息\n    if (noticeList.length < 1) return\n\n    noticeContainer.append(noticeList)\n    ssi_modal.show({\n      className: 'in-page-edit ipe-special-notice',\n      sizeClass: 'dialog',\n      outSideClose: false,\n      center: true,\n      title: _msg('version-notice-title'),\n      content: noticeContainer,\n      buttons: [\n        {\n          label: _msg('updatelog-dismiss'),\n          className: 'btn btn-single',\n          method(e, modal) {\n            modal.close()\n            $.each(noticeList, (_, item) => {\n              setLocal(item)\n            })\n          },\n        },\n      ],\n    })\n  })\n}\n\nmodule.exports = {\n  specialNotice,\n  getNotice,\n}\n","/**\n * @module stepModal 分步走模态框\n *\n * @param {Object} params\n * @param {Array} params.contents Modal contents { title: String, content: String, method: Function }\n * @param {Number} params.step From step, 1 means first one\n * @param {String} params.btnBefore\n * @param {String} params.btnAfter\n * @param {String} param.btnDone\n * @param {Function} param.afterDone\n * @param {Function} param.onShow\n *\n * @return {Promise} After done\n * @return {Object} $modal Modal Obj\n *\n * @example stepModal([{\n *   title: 'step 1 title',\n *   content: 'step 1 content',\n *   method(modal) {}\n * }]).then(()=>console.log('done'))\n */\nvar stepModal = params => {\n  var $def = $.Deferred()\n  var {\n    title,\n    content,\n    contents,\n    step,\n    btnBefore,\n    btnAfter,\n    btnDone,\n    afterDone,\n    onShow,\n  } = params\n\n  // 规范变量\n  contents = contents || content\n  if (typeof contents !== 'object')\n    throw 'stepModal contents type error: Unexpected type ' + typeof contents\n  if (contents.length < 1) throw 'stepModal missing contents'\n  $.each(contents, (key, val) => {\n    if (typeof val === 'string') val = { content: val }\n    if (!val.title) val.title = title || ''\n    if (!val.content) val.content = ''\n    contents[key] = val\n  })\n  step = step || 1\n  if (isNaN(step) || step < 1) step = 1\n  if (!contents[step]) step = 1\n\n  // content 数组前插一位，方便处理以下逻辑：\n  // step1 指的就是第一步，而不是数组的第二个\n  try {\n    contents.unshift(0)\n  } catch (e) {\n    console.error('stepModal unknown error', e)\n    return\n  }\n  var allSteps = contents.length - 1\n\n  var $modal = ssi_modal\n    .createObject({\n      center: 1,\n      className:\n        'in-page-edit ipe-stepModal ' +\n        (params.className ? params.className : ''),\n      sizeClass: params.sizeClass || 'small',\n      outSideClose: 0,\n      onShow(modal) {\n        onShow && onShow(modal)\n      },\n    })\n    .init()\n  var $modalObj = $(document.getElementById($modal.modalId))\n\n  $modal.setButtons([\n    {\n      label: btnBefore ? btnBefore : '← before',\n      className: 'btn btn-secondary btn-before',\n      side: 'left',\n      method: before,\n    },\n    {\n      label: btnAfter ? btnAfter : 'after →',\n      className: 'btn btn-secondary btn-after',\n      method: after,\n    },\n    {\n      label: btnDone ? btnDone : 'done √',\n      className: 'btn btn-primary btn-done',\n      method(e, modal) {\n        modal.close()\n        $def.resolve()\n        afterDone && afterDone()\n      },\n    },\n  ])\n\n  var $btnBefore = $modalObj.find('.btn-before'),\n    $btnAfter = $modalObj.find('.btn-after'),\n    $btnDone = $modalObj.find('.btn-done')\n\n  // 设定初始状态\n  $btnDone.hide()\n  if (step === 1) $btnBefore.hide()\n  if (step === allSteps) {\n    $btnAfter.hide()\n    $btnDone.show()\n  }\n  $modalObj.find('.ssi-closeIcon').hide()\n\n  /**\n   * @function setStep\n   * @param {Number} step\n   */\n  function setStep(step) {\n    $modal.setTitle(`${contents[step].title} (${step}/${allSteps})`)\n    $modal.setContent(contents[step].content)\n    if (contents[step].method && typeof contents[step].method === 'function')\n      contents[step].method($modal)\n  }\n\n  /**\n   * @function before\n   */\n  function before(modal) {\n    var $btn = $(modal.target)\n    if (step <= 1) return (step = 1)\n\n    $btnAfter.show()\n    $btnDone.hide()\n\n    step--\n    setStep(step)\n\n    if (step <= 1) $btn.hide()\n  }\n\n  /**\n   * @function after\n   */\n  function after(modal) {\n    var $btn = $(modal.target)\n    if (step >= allSteps) return (step = allSteps)\n\n    $btnBefore.show()\n\n    step++\n    setStep(step)\n\n    if (step >= allSteps) {\n      $btn.hide()\n      $btnDone.show()\n    }\n  }\n\n  // init\n  $modal.show()\n  setStep(step)\n\n  $def.$modal = $modal\n  return $def\n}\n\nmodule.exports = {\n  stepModal,\n}\n","const version = require('../package.json').version\n\nmodule.exports = version\n","const { _msg } = require('./_msg')\n\nconst api = require('./api.json')\nconst version = require('./version')\n\n/**\n * @module versionInfo 版本信息模块\n * @description Show Update Logs Modal box\n */\nvar versionInfo = function () {\n  // 显示模态框\n  ssi_modal.show({\n    className: 'in-page-edit update-logs-modal',\n    title:\n      _msg('updatelog-title') +\n      ' - <span id=\"yourVersion\">' +\n      version +\n      '</span>',\n    content: $('<section>').append(\n      $('<iframe>', {\n        style: 'margin: 0;padding: 0;width: 100%;height: 80vh;border: 0;',\n        src: api.updatelogsUrl,\n      })\n    ),\n    buttons: [\n      {\n        label: 'GitHub',\n        className: 'btn btn-secondary',\n        method: function () {\n          window.open(api.githubLink)\n        },\n      },\n      {\n        label: _msg('updatelog-about'),\n        className: 'btn btn-secondary',\n        method: function () {\n          window.open(api.aboutUrl)\n        },\n      },\n      {\n        label: _msg('close'),\n        className: 'btn btn-primary',\n        method: function (a, modal) {\n          modal.close()\n        },\n      },\n    ],\n  })\n}\n\nmodule.exports = {\n  versionInfo,\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/**\n * @license GPL-3.0 GNU GENERAL PUBLIC LICENSE 3.0\n *\n * @name InPageEdit\n * @description A useful MediaWiki JavaScript Plugin written with jQuery\n * @author 机智的小鱼君 Dragon-Fish <dragon-fish@qq.com>\n * @url https://github.com/Dragon-Fish/InPageEdit-v2\n */\n\n!(async function () {\n  'use strict'\n\n  // 创建 InPageEdit 变量\n  var InPageEdit = window.InPageEdit || {}\n\n  // 防止多次运行\n  if (InPageEdit.loaded) {\n    throw '[InPageEdit] InPageEdit 已经在运行了'\n  } else {\n    InPageEdit.loaded = true\n  }\n\n  // 初始化插件\n  var init = require('./method/init')\n\n  var mainFunctions = await init()\n\n  // 合并入全局变量\n  window.InPageEdit = $.extend({}, window.InPageEdit, mainFunctions)\n})()\n"],"sourceRoot":""}